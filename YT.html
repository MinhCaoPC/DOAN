<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Danh s√°ch y√™u th√≠ch</title>
  <!-- Bootstrap -->
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">
  <link href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.3/font/bootstrap-icons.css" rel="stylesheet">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.2/css/all.min.css">

  <!-- CSS ri√™ng -->
  <link rel="stylesheet" href="YT.css">
</head>

<body>
  <!-- Navbar -->
  <nav class="navbar navbar-expand-lg navbar-dark navbar-custom fixed-top" id="navbar">
    <div class="container">
      <!-- Logo -->
      <a class="navbar-logo-fixed" href="#">
        <img src="images/logo.png" alt="Logo" class="logo-fixed" />
      </a>

      <!-- Toggler -->
      <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarMenu">
        <span class="navbar-toggler-icon"></span>
      </button>

      <!-- Menu -->
      <div class="collapse navbar-collapse justify-content-center" id="navbarMenu">
        <ul class="navbar-nav">
          <li class="nav-item"><a class="nav-link" href="TrangChu.html">TRANG CH·ª¶</a></li>
          <li class="nav-item">
            <a class="nav-link" href="diaDanh.html">ƒê·ªäA DANH N·ªîI B·∫¨T</a>
          </li>
          <li class="nav-item"><a class="nav-link" href="Food.html">·∫®M TH·ª∞C</a></li>
          <li class="nav-item">
            <a class="nav-link" href="nghiDuong.html">NGH·ªà D∆Ø·ª†NG</a>
          </li>
          <li class="nav-item">
            <a class="nav-link" href="tour.html">TOUR</a>
          </li>
        </ul>


        <div class="login-section" id="login-section">
          <a href="dangNhap.html" class="login-text">
            <i class="bi bi-person-circle me-2 fs-5"></i>ƒêƒÇNG NH·∫¨P
          </a>
        </div>
      </div>
    </div>
  </nav>

  <!-- banner -->
  <div class="favorite-banner">
    <div class="favorite-banner__content">
      <h1>Danh S√°ch y√™u th√≠ch</h1>
    </div>
  </div>

  <div class="banner-divider"></div>


  <div class="favorites-section">
    <!-- C·ªôt tr√°i: danh s√°ch ph√¢n lo·∫°i -->
    <aside class="favorites-sidebar">
  <h2>Ph√¢n lo·∫°i</h2>
  <ul id="filter-list">
    <li data-filter="ALL" class="active">T·∫•t c·∫£</li>
    <li data-filter="DIADANH">ƒê·ªãa danh</li>
    <li data-filter="MONAN">·∫®m th·ª±c</li>
    <li data-filter="KND">Ngh·ªâ d∆∞·ª°ng - vui ch∆°i</li>
    <li data-filter="TOUR">Tour</li>
  </ul>
</aside>





    <!-- C·ªôt ph·∫£i: danh s√°ch y√™u th√≠ch -->
    <div class="favorites-cards">

      </div>


    </div>
  </div>
  </div>

  </div>


  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"></script>
<script>
  let isLoggedIn = false;
  let allFavorites = []; // l∆∞u to√†n b·ªô items ƒë·ªÉ filter

  // Render danh s√°ch y√™u th√≠ch (theo list ƒë√£ l·ªçc)
  function renderFavorites(items) {
    const container = document.querySelector(".favorites-cards");
    container.innerHTML = "";

    if (!items || items.length === 0) {
      container.innerHTML = `
        <div class="alert alert-info">
          B·∫°n ch∆∞a c√≥ m·ª•c y√™u th√≠ch n√†o. H√£y quay l·∫°i c√°c trang ƒê·ªãa danh / ·∫®m th·ª±c / Ngh·ªâ d∆∞·ª°ng / Tour v√† b·∫•m icon tr√°i tim üíñ nh√©!
        </div>`;
      return;
    }

    items.forEach((item) => {
      const box = document.createElement("div");
      box.className = "content-box";

      // label lo·∫°i cho ƒë·∫πp (ƒê·ªãa danh / ·∫®m th·ª±c / ...)
      let label = "";
      switch (item.loai) {
        case "DIADANH": label = "ƒê·ªãa danh"; break;
        case "MONAN": label = "·∫®m th·ª±c"; break;
        case "KND": label = "Ngh·ªâ d∆∞·ª°ng - vui ch∆°i"; break;
        case "TOUR": label = "Tour"; break;
      }

      box.innerHTML = `
        <img src="${item.anh}" alt="${item.ten}">
        <div class="text-box">
          <div class="d-flex justify-content-between align-items-center mb-2">
            <h3 class="mb-0">${item.ten}</h3>
          </div>
          <p>${item.moTa || ""}</p>
          <span class="badge bg-primary">${label}</span>
          <div class="content-box-buttons">
            <button class="btn-circle btn-close" onclick="removeFavorite('${item.loai}', ${item.id})">
              <i class="fa fa-times"></i>
            </button>
          </div>
        </div>
      `;

      container.appendChild(box);
    });
  }

  // √Åp d·ª•ng filter theo lo·∫°i
  function applyFilter(type) {
    let filtered = allFavorites;

    if (type && type !== "ALL") {
      filtered = allFavorites.filter((item) => item.loai === type);
    }

    renderFavorites(filtered);
  }

  // X√≥a kh·ªèi y√™u th√≠ch
  async function removeFavorite(loai, id) {
    if (!confirm("B·∫°n ch·∫Øc ch·∫Øn mu·ªën x√≥a m·ª•c n√†y kh·ªèi danh s√°ch y√™u th√≠ch?")) return;

    try {
      const res = await fetch("YT.php", {
        method: "POST",
        headers: {
          "Content-Type": "application/json",
        },
        body: JSON.stringify({
          action: "remove",
          loai: loai,
          id: id,
        }),
      });

      const data = await res.json();
      if (data.success) {
        alert("ƒê√£ x√≥a kh·ªèi danh s√°ch y√™u th√≠ch.");
        loadFavorites();
      } else {
        alert("‚ö†Ô∏è " + data.message);
      }
    } catch (err) {
      console.error(err);
      alert("C√≥ l·ªói khi x√≥a y√™u th√≠ch.");
    }
  }

  // Load danh s√°ch y√™u th√≠ch t·ª´ server
  async function loadFavorites() {
    try {
      const res = await fetch("YTList.php", { cache: "no-store" });
      const data = await res.json();

      if (!data.loggedIn) {
        alert("B·∫°n c·∫ßn ƒëƒÉng nh·∫≠p ƒë·ªÉ xem m·ª•c y√™u th√≠ch.");
        window.location.href = "dangNhap.html";
        return;
      }

      isLoggedIn = true;
      allFavorites = data.items || [];
      // m·∫∑c ƒë·ªãnh hi·ªÉn th·ªã t·∫•t c·∫£
      applyFilter("ALL");
    } catch (err) {
      console.error(err);
      const container = document.querySelector(".favorites-cards");
      container.innerHTML = `<div class="alert alert-danger">Kh√¥ng t·∫£i ƒë∆∞·ª£c danh s√°ch y√™u th√≠ch.</div>`;
    }
  }

  // ========= INIT =========
  document.addEventListener("DOMContentLoaded", () => {
    const loginSection = document.getElementById('login-section');
    const navbarMenu = document.getElementById('navbarMenu');

    // setup click filter
    const filterList = document.getElementById("filter-list");
    if (filterList) {
      filterList.querySelectorAll("li").forEach((li) => {
        li.addEventListener("click", () => {
          filterList.querySelectorAll("li").forEach((x) => x.classList.remove("active"));
          li.classList.add("active");
          const type = li.dataset.filter || "ALL";
          applyFilter(type);
        });
      });
    }

    // check user + load favorites
    fetch('getUser.php')
      .then(res => res.json())
      .then(data => {
        if (data.loggedIn) {
          isLoggedIn = true;

          // Thay n·ªôi dung login-section
          loginSection.innerHTML = `
            <a class="login-text" href="suaHS.html">
              <i class="bi bi-person-circle me-2 fs-5"></i>${data.TenTaiKhoan}
            </a>
            <a href="dangXuat.php" class="login-text ms-3">
              <i class="bi bi-box-arrow-in-right me-2 fs-5"></i>ƒêƒÇNG XU·∫§T
            </a>
          `;

          // Th√™m m·ª•c y√™u th√≠ch v√†o menu
          navbarMenu.querySelector('ul.navbar-nav').innerHTML = `
            <li class="nav-item"><a class="nav-link" href="TrangChu.html">TRANG CH·ª¶</a></li>
            <li class="nav-item"><a class="nav-link" href="diaDanh.html">ƒê·ªäA DANH N·ªîI B·∫¨T</a></li>
            <li class="nav-item"><a class="nav-link" href="Food.html">·∫®M TH·ª∞C</a></li>
            <li class="nav-item"><a class="nav-link" href="nghiDuong.html">NGH·ªà D∆Ø·ª†NG</a></li>
            <li class="nav-item"><a class="nav-link" href="tour.html">TOUR</a></li>
            <li class="nav-item"><a class="nav-link" href="YT.html">M·ª§C Y√äU TH√çCH</a></li>
            <li class="nav-item"><a class="nav-link" href="Lichsu.html">L·ªäCH S·ª¨ ƒê·∫∂T TOUR</a></li>
          `;
        }

        // D√π login hay kh√¥ng, loadFavorites s·∫Ω t·ª± x·ª≠ l√Ω redirect
        loadFavorites();
      });
  });
</script>





</body>

</html>