<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Äá»‹a Danh Du Lá»‹ch</title>
  <!-- Bootstrap -->
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet" />
  <link href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.3/font/bootstrap-icons.css" rel="stylesheet" />

  <!-- CSS riÃªng -->
  <link rel="stylesheet" href="diaDanh.css" />
</head>

<body>
  <!-- Navbar -->
  <nav class="navbar navbar-expand-lg navbar-dark navbar-custom fixed-top">
    <div class="container">
      <!-- Logo -->
      <a class="navbar-logo-fixed" href="#">
        <img src="images/logo.png" alt="Logo" class="logo-fixed" />
      </a>

      <!-- Toggler -->
      <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarMenu">
        <span class="navbar-toggler-icon"></span>
      </button>

      <!-- Menu -->
      <div class="collapse navbar-collapse justify-content-center" id="navbarMenu">
        <ul class="navbar-nav">
          <li class="nav-item">
            <a class="nav-link" href="TrangChu.html">TRANG CHá»¦</a>
          </li>
          <li class="nav-item">
            <a class="nav-link" href="#">Äá»ŠA DANH Ná»”I Báº¬T</a>
          </li>
          <li class="nav-item">
            <a class="nav-link" href="Food.html">áº¨M THá»°C</a>
          </li>
          <li class="nav-item">
            <a class="nav-link" href="nghiDuong.html">NGHá»ˆ DÆ¯á» NG</a>
          </li>
          <li class="nav-item">
            <a class="nav-link" href="tour.html">TOUR</a>
          </li>
        </ul>

        <div class="login-section" id="login-section">
          <a href="dangNhap.html" class="login-text">
            <i class="bi bi-person-circle me-2 fs-5"></i>ÄÄ‚NG NHáº¬P
          </a>
        </div>
      </div>
    </div>
  </nav>

  <!-- Banner -->
  <section id="banner" class="position-relative text-center text-light">
    <img src="anh/banner_diadanh.jpg" alt="Banner" class="banner-img w-100" />
    <div class="banner-overlay"></div>

    <!-- Thanh tÃ¬m kiáº¿m -->
    <div class="search-container position-absolute top-50 start-50 translate-middle text-center">
      <h2 class="mb-4 fw-bold text-shadow">KhÃ¡m PhÃ¡ Äá»‹a Danh ÄÃ  Náºµng</h2>

      <form class="search-form position-relative d-inline-block" onsubmit="return searchDiaDanh(event)">
        <input id="searchInput" type="text" class="form-control search-input" placeholder="TÃ¬m kiáº¿m Ä‘á»‹a danh..."
          autocomplete="off" />
        <button class="btn-search" type="submit">
          <i class="bi bi-search"></i>
        </button>

        <div id="suggestionsBox" class="list-group position-absolute w-100 shadow"></div>

      </form>
    </div>
  </section>

  <!-- Giá»›i thiá»‡u + PhÃ¢n loáº¡i -->
  <section id="diadanh" class="diadanh-section">
    <div class="intro danang-desc">
      <p>
        Náº±m ngay trung tÃ¢m dáº£i Ä‘áº¥t hÃ¬nh chá»¯ S, ÄÃ  Náºµng khÃ´ng chá»‰ lÃ  â€œthÃ nh phá»‘
        Ä‘Ã¡ng sá»‘ng nháº¥t Viá»‡t Namâ€ mÃ  cÃ²n lÃ  má»™t cá»•ng ngÃµ tráº£i nghiá»‡m khÃ´ng
        ngá»«ng nghá»‰.
        <br /><br />
        NÆ¡i Ä‘Ã¢y há»™i tá»¥ má»™t báº£n giao hÆ°á»Ÿng hÃ i hÃ²a: váº» Ä‘áº¹p hÃ¹ng vÄ© cá»§a bÃ¡n Ä‘áº£o
        SÆ¡n TrÃ , sá»± quyáº¿n rÅ© cá»§a bÃ£i biá»ƒn Má»¹ KhÃª, sá»± lÃ£ng máº¡n cá»§a sÃ´ng HÃ n vÃ 
        nhá»‹p sá»‘ng Ä‘Ã´ thá»‹ thÃ´ng minh, hiá»‡n Ä‘áº¡i. Tá»« Cáº§u Rá»“ng phun lá»­a rá»±c rá»¡ Ä‘áº¿n
        BÃ  NÃ  Hills nhÆ° xá»© sá»Ÿ cá»• tÃ­ch â€“ ÄÃ  Náºµng luÃ´n biáº¿t cÃ¡ch chinh phá»¥c trÃ¡i
        tim du khÃ¡ch.
      </p>
    </div>

    <div class="text-center mb-4 buttons">
      <button class="btn-food active" onclick="toggleSection('dacSan', event)">
        Äá»‹a danh
      </button>
      <button class="btn-food" onclick="toggleSection('haiSan', event)">
        Äá»‹a danh thiÃªn nhiÃªn
      </button>
      <button class="btn-food" onclick="toggleSection('duongPho', event)">
        Äá»‹a danh cÃ´ng trÃ¬nh kiáº¿n trÃºc
      </button>
      <button class="btn-food" onclick="toggleSection('Qua', event)">
        Äá»‹a danh vÄƒn hoÃ¡ - nghá»‡ thuáº­t
      </button>
    </div>
    <section class="content-section">
      <div id="DiaDanhDN" class="wrapper"></div>
    </section>
  </section>

  <!-- ğŸŒŠ Footer -->
  <footer class="footer text-light">
    <div class="container py-5">
      <div class="row gy-4">
        <!-- Logo & MÃ´ táº£ -->
        <div class="col-md-4">
          <h3 class="footer-logo">ÄÃ  Náºµng Travel</h3>
          <p>
            KhÃ¡m phÃ¡ váº» Ä‘áº¹p ÄÃ  Náºµng â€“ thÃ nh phá»‘ Ä‘Ã¡ng sá»‘ng nháº¥t Viá»‡t Nam. ChÃºng
            tÃ´i mang Ä‘áº¿n nhá»¯ng tráº£i nghiá»‡m du lá»‹ch Ä‘á»™c Ä‘Ã¡o vÃ  tiá»‡n lá»£i.
          </p>
        </div>

        <!-- LiÃªn káº¿t nhanh -->
        <div class="col-md-4">
          <h5>LiÃªn káº¿t nhanh</h5>
          <ul class="footer-links">
            <li><a href="#about">Giá»›i thiá»‡u</a></li>
            <li><a href="diaDanh.html">Äá»‹a Danh</a></li>
            <li><a href="nghiDuong.html">Nghá»‰ DÆ°á»¡ng</a></li>
            <li><a href="Food.html">áº¨m thá»±c</a></li>
            <li><a href="tour.html">Tour</a></li>
            <li><a href="lienhe.html">LiÃªn há»‡</a></li>
          </ul>
        </div>

        <!-- LiÃªn há»‡ & Máº¡ng xÃ£ há»™i -->
        <div class="col-md-4">
          <h5>LiÃªn há»‡</h5>
          <p>
            <i class="fas fa-map-marker-alt"></i> 123 ÄÆ°á»ng Báº¡ch Äáº±ng, ÄÃ  Náºµng
          </p>
          <p><i class="fas fa-phone"></i> 0901 234 567</p>
          <p><i class="fas fa-envelope"></i> info@danangtravel.vn</p>

          <div class="social-icons mt-3">
            <a href="#"><i class="fab fa-facebook-f"></i></a>
            <a href="#"><i class="fab fa-instagram"></i></a>
            <a href="#"><i class="fab fa-tiktok"></i></a>
          </div>
        </div>
      </div>
    </div>

    <div class="footer-bottom text-center py-3">
      <p>Â© 2025 ÄÃ  Náºµng Travel. Thiáº¿t káº¿ bá»Ÿi <strong>CTV Team</strong>.</p>
    </div>
  </footer>

  <!-- JS -->
  <script>
    // ========= STATE =========
    let diaDanhList = [];
    let isLoggedIn = false;

    // Láº¥y cÃ¡c pháº§n tá»­ DOM 1 láº§n
    const searchInput = document.getElementById("searchInput");
    const suggestionsBox = document.getElementById("suggestionsBox");
    const loginSection = document.getElementById("login-section");
    const navbarMenu = document.getElementById("navbarMenu");

    // ========= CÃC HÃ€M CHÃNH =========

    function handleHashScroll() {
      const hash = window.location.hash;
      if (hash) {
        setTimeout(() => {
          const targetElement = document.querySelector(hash);
          if (targetElement) {
            targetElement.scrollIntoView({ behavior: 'smooth', block: 'start' });
            targetElement.style.transition = 'box-shadow 0.3s ease-in-out';
            targetElement.style.boxShadow = '0 0 15px 5px rgba(0, 123, 255, 0.7)';
            setTimeout(() => {
              targetElement.style.boxShadow = 'none';
            }, 2000);
          }
        }, 200);
      }
    }

    async function loadDiaDanh() {
      try {
        const res = await fetch("diaDanh.php", { cache: "no-store" });
        if (!res.ok) throw new Error("Load failed");
        const data = await res.json();

        diaDanhList = data.map((d) => ({
          id: d.MaDD,
          ten: d.TenDD,
          moTa: d.MoTaDD,
          anh: d.ImageDD,
          nhom: d.LoaiDD,
          map: d.MapLinkDD,
          diaChi: d.DiaChiDD,
        }));

        renderDiaDanh(diaDanhList);
        handleHashScroll();
      } catch (e) {
        console.error(e);
        document.getElementById("DiaDanhDN").innerHTML = `<div class="alert alert-danger">KhÃ´ng táº£i Ä‘Æ°á»£c dá»¯ liá»‡u Ä‘á»‹a danh.</div>`;
      }
    }

    function renderDiaDanh(list) {
      const container = document.getElementById("DiaDanhDN");
      container.innerHTML = "";
      list.forEach((diaDanh, index) => {
        const hasMap = !!diaDanh.map;
        const html = `
        <div class="content-box fade-in mb-4" id="item-dd-${diaDanh.id}">
          <div id="media-${index}" class="media-box" data-showing="image">
            <img src="${diaDanh.anh}" alt="${diaDanh.ten}" class="rounded shadow-sm w-100" />
          </div>
          <div class="text-box mt-3">
            <h5 class="text-center fw-bold">${diaDanh.ten}</h5>
            ${diaDanh.diaChi ? `<p class="text-center text-muted mb-1"><i class="bi bi-geo-alt"></i> ${diaDanh.diaChi}</p>` : ``}
            <p class="mo-ta mb-2">${diaDanh.moTa}</p>
            <div class="d-flex justify-content-center gap-3 flex-wrap">
              ${hasMap ? `<button class="btn btn-outline-primary nuthanhdong" id="btnMap-${index}" onclick="toggleMap(${index}, '${encodeURIComponent(diaDanh.anh)}', '${encodeURIComponent(diaDanh.map)}')"><i class="bi bi-geo-alt"></i></button>` : ``}
              <button class="btn btn-outline-success nuthanhdong" onclick="handleYeuThich(${diaDanh.id || "null"})"><i class="bi bi-heart"></i></button>
            </div>
          </div>
        </div>`;
        container.insertAdjacentHTML("beforeend", html);
      });
    }

    // Xá»­ lÃ½ khi nháº¥n nÃºt TÃ¬m kiáº¿m (Enter)
    function searchDiaDanh(e) {
      e.preventDefault();
      const kw = searchInput.value.trim().toLowerCase();
      const activeBtn = document.querySelector(".btn-food.active");
      const loai = activeBtn ? activeBtn.getAttribute('onclick').match(/'(dacSan|haiSan|duongPho|Qua)'/)[1] : 'dacSan';

      let nhom = "all";
      if (loai === "haiSan") nhom = "thiennhien";
      else if (loai === "duongPho") nhom = "congtrinh";
      else if (loai === "Qua") nhom = "vanhoa";

      const filtered = diaDanhList.filter((d) =>
        (nhom === "all" || d.nhom === nhom) &&
        (d.ten.toLowerCase().includes(kw) ||
          d.moTa.toLowerCase().includes(kw) ||
          (d.diaChi && d.diaChi.toLowerCase().includes(kw)))
      );

      renderDiaDanh(filtered);
      suggestionsBox.innerHTML = ''; // ÄÃ³ng gá»£i Ã½

      // â­ --- PHáº¦N CODE Má»šI Äá»‚ Tá»° TRÆ¯á»¢T XUá»NG --- â­
      if (filtered.length > 0) {
        // Láº¥y ID cá»§a item Ä‘áº§u tiÃªn (vÃ­ dá»¥: 'item-dd-1')
        const firstResultId = `item-dd-${filtered[0].id}`;
        const firstResultElement = document.getElementById(firstResultId);

        if (firstResultElement) {
          // ThÃªm 1 chÃºt delay Ä‘á»ƒ DOM ká»‹p váº½
          setTimeout(() => {
            firstResultElement.scrollIntoView({ behavior: 'smooth', block: 'start' });
          }, 100);
        }
      }
      // â­ --- Háº¾T PHáº¦N CODE Má»šI --- â­

      return false;
    }

    // Xá»­ lÃ½ khi nháº¥n nÃºt PhÃ¢n loáº¡i
    function toggleSection(loai, e) {
      document.querySelectorAll(".btn-food").forEach((b) => b.classList.remove("active"));
      e.target.classList.add("active");
      searchDiaDanh(new Event('submit'));
    }

    // Xá»­ lÃ½ báº­t/táº¯t báº£n Ä‘á»“
    function toggleMap(index, imgPathEncoded, mapLinkEncoded) {
      const imgPath = decodeURIComponent(imgPathEncoded);
      const mapLink = decodeURIComponent(mapLinkEncoded);
      const mediaDiv = document.getElementById(`media-${index}`);
      const btn = document.getElementById(`btnMap-${index}`);
      const showing = mediaDiv.dataset.showing;

      if (showing === "map") {
        mediaDiv.innerHTML = `<img src="${imgPath}" alt="áº£nh Ä‘á»‹a danh" class="img-fluid rounded shadow-sm" />`;
        mediaDiv.dataset.showing = "image";
        btn.firstElementChild.className = "bi bi-geo-alt";
      } else {
        mediaDiv.innerHTML = `<iframe src="${mapLink}" width="100%" height="350" style="border:0;" allowfullscreen loading="lazy"></iframe>`;
        mediaDiv.dataset.showing = "map";
        btn.firstElementChild.className = "bi bi-image";
      }
    }

    // Xá»­ lÃ½ nÃºt YÃªu thÃ­ch
    async function handleYeuThich(id) {
      if (!isLoggedIn) {
        const goLogin = confirm("Vui lÃ²ng Ä‘Äƒng nháº­p Ä‘á»ƒ thÃªm Ä‘á»‹a danh vÃ o yÃªu thÃ­ch!");
        if (goLogin) window.location.href = "dangNhap.html";
        return;
      }
      try {
        const res = await fetch("YT.php", {
          method: "POST",
          headers: { "Content-Type": "application/json" },
          body: JSON.stringify({ action: "add", loai: "DIADANH", id: id }),
        });
        const data = await res.json();
        if (data.needLogin) {
          alert("PhiÃªn Ä‘Äƒng nháº­p Ä‘Ã£ háº¿t háº¡n. Vui lÃ²ng Ä‘Äƒng nháº­p!");
          window.location.href = "dangNhap.html";
        } else if (data.success) {
          alert(data.message || "ÄÃ£ thÃªm vÃ o má»¥c yÃªu thÃ­ch!");
        } else {
          alert(data.message || "Má»¥c nÃ y Ä‘Ã£ cÃ³ trong má»¥c yÃªu thÃ­ch!");
        }
      } catch (err) {
        console.error(err);
        alert("ÄÃ£ cÃ³ lá»—i xáº£y ra. Vui lÃ²ng thá»­ láº¡i sau!");
      }
    }

    // --- CÃC HÃ€M Má»šI CHO Gá»¢I Ã TÃŒM KIáº¾M ---
    function handleSearchInput(e) {
      const term = e.target.value.trim().toLowerCase();
      if (term.length === 0) {
        suggestionsBox.innerHTML = '';
        return;
      }
      const suggestions = diaDanhList
        .filter(d => d.ten.toLowerCase().includes(term))
        .map(d => d.ten);
      const limitedSuggestions = [...new Set(suggestions)].slice(0, 5);
      renderSuggestions(limitedSuggestions);
    }

    function renderSuggestions(suggestions) {
      suggestionsBox.innerHTML = '';
      if (suggestions.length === 0) return;
      suggestions.forEach(suggestion => {
        const item = document.createElement('a');
        item.className = 'list-group-item list-group-item-action';
        item.textContent = suggestion;
        item.onclick = () => selectSuggestion(suggestion);
        suggestionsBox.appendChild(item);
      });
    }

    function selectSuggestion(suggestion) {
      searchInput.value = suggestion;
      suggestionsBox.innerHTML = '';
      document.querySelectorAll(".btn-food").forEach((b) => b.classList.remove("active"));
      document.querySelector(".btn-food[onclick*='dacSan']").classList.add("active");
      searchDiaDanh(new Event('submit'));
    }

    // ========= INIT (KHá»I CHáº Y) =========
    document.addEventListener("DOMContentLoaded", () => {
      loadDiaDanh();
      window.addEventListener('hashchange', handleHashScroll);
      fetch("getUser.php")
        .then((res) => res.json())
        .then((data) => {
          if (data.loggedIn) {
            isLoggedIn = true;
            loginSection.innerHTML = `
              <a class="login-text" href ="suaHS.html"><i class="bi bi-person-circle me-2 fs-5" ></i>${data.TenTaiKhoan}</a>
              <a href="dangXuat.php" class="login-text ms-3">
                <i class="bi bi-box-arrow-in-right me-2 fs-5"></i>ÄÄ‚NG XUáº¤T
              </a>`;
            navbarMenu.querySelector("ul.navbar-nav").innerHTML = `
              <li class="nav-item"><a class="nav-link" href="TrangChu.html">TRANG CHá»¦</a></li>
              <li class="nav-item"><a class="nav-link" href="diaDanh.html">Äá»ŠA DANH Ná»”I Báº¬T</a></li>
              <li class="nav-item"><a class="nav-link" href="Food.html">áº¨M THá»°C</a></li>
              <li class="nav-item"><a class="nav-link" href="nghiDuong.html">NGHá»ˆ DÆ¯á» NG</a></li>
              <li class="nav-item"><a class="nav-link" href="tour.html">TOUR</a></li>
              <li class="nav-item"><a class="nav-link" href="YT.html">Má»¤C YÃŠU THÃCH</a></li>
              <li class="nav-item"><a class="nav-link" href="Lichsu.html">Lá»ŠCH Sá»¬ Äáº¶T TOUR</a></li>
            `;
          }
        });
      searchInput.addEventListener('input', handleSearchInput);
      document.addEventListener('click', function (e) {
        if (e.target !== searchInput && !suggestionsBox.contains(e.target)) {
          suggestionsBox.innerHTML = '';
        }
      });
    });
  </script>
  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"></script>
</body>

</html>