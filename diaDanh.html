<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>ƒê·ªãa Danh Du L·ªãch</title>
    <!-- Bootstrap -->
    <link
      href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css"
      rel="stylesheet"
    />
    <link
      href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.3/font/bootstrap-icons.css"
      rel="stylesheet"
    />

    <!-- CSS ri√™ng -->
    <link rel="stylesheet" href="diaDanh.css" />
  </head>

  <body>
    <!-- Navbar -->
    <nav class="navbar navbar-expand-lg navbar-dark navbar-custom fixed-top">
      <div class="container">
        <!-- Logo -->
        <a class="navbar-logo-fixed" href="#">
          <img src="images/logo.png" alt="Logo" class="logo-fixed" />
        </a>

        <!-- Toggler -->
        <button
          class="navbar-toggler"
          type="button"
          data-bs-toggle="collapse"
          data-bs-target="#navbarMenu"
        >
          <span class="navbar-toggler-icon"></span>
        </button>

        <!-- Menu -->
        <div
          class="collapse navbar-collapse justify-content-center"
          id="navbarMenu"
        >
          <ul class="navbar-nav">
            <li class="nav-item">
              <a class="nav-link" href="TrangChu.html">TRANG CH·ª¶</a>
            </li>
            <li class="nav-item">
              <a class="nav-link" href="#">ƒê·ªäA DANH N·ªîI B·∫¨T</a>
            </li>
            <li class="nav-item">
              <a class="nav-link" href="Food.html">·∫®M TH·ª∞C</a>
            </li>
            <li class="nav-item">
              <a class="nav-link" href="nghiDuong.html">NGH·ªà D∆Ø·ª†NG</a>
            </li>
            <li class="nav-item">
              <a class="nav-link" href="tour.html">TOUR</a>
            </li>
          </ul>

          <div class="login-section" id="login-section">
            <a href="dangNhap.html" class="login-text">
              <i class="bi bi-person-circle me-2 fs-5"></i>ƒêƒÇNG NH·∫¨P
            </a>
          </div>
        </div>
      </div>
    </nav>

    <!-- Banner -->
    <section id="banner" class="position-relative text-center text-light">
      <img src="anh/banner_diadanh.jpg" alt="Banner" class="banner-img w-100" />
      <div class="banner-overlay"></div>

      <!-- Thanh t√¨m ki·∫øm -->
      <div
        class="search-container position-absolute top-50 start-50 translate-middle text-center"
      >
        <h2 class="mb-4 fw-bold text-shadow">Kh√°m Ph√° ƒê·ªãa Danh ƒê√† N·∫µng</h2>

        <form
          class="search-form position-relative d-inline-block"
          onsubmit="return searchDiaDanh(event)"
        >
          <input
            id="searchInput"
            type="text"
            class="form-control search-input"
            placeholder="T√¨m ki·∫øm ƒë·ªãa danh..."
          />
          <button class="btn-search" type="submit">
            <i class="bi bi-search"></i>
          </button>
        </form>
      </div>
    </section>

    <!-- Gi·ªõi thi·ªáu + Ph√¢n lo·∫°i -->
    <section id="diadanh" class="diadanh-section">
      <div class="intro danang-desc">
        <p>
          N·∫±m ngay trung t√¢m d·∫£i ƒë·∫•t h√¨nh ch·ªØ S, ƒê√† N·∫µng kh√¥ng ch·ªâ l√† ‚Äúth√†nh ph·ªë
          ƒë√°ng s·ªëng nh·∫•t Vi·ªát Nam‚Äù m√† c√≤n l√† m·ªôt c·ªïng ng√µ tr·∫£i nghi·ªám kh√¥ng
          ng·ª´ng ngh·ªâ.
          <br /><br />
          N∆°i ƒë√¢y h·ªôi t·ª• m·ªôt b·∫£n giao h∆∞·ªüng h√†i h√≤a: v·∫ª ƒë·∫πp h√πng vƒ© c·ªßa b√°n ƒë·∫£o
          S∆°n Tr√†, s·ª± quy·∫øn r≈© c·ªßa b√£i bi·ªÉn M·ªπ Kh√™, s·ª± l√£ng m·∫°n c·ªßa s√¥ng H√†n v√†
          nh·ªãp s·ªëng ƒë√¥ th·ªã th√¥ng minh, hi·ªán ƒë·∫°i. T·ª´ C·∫ßu R·ªìng phun l·ª≠a r·ª±c r·ª° ƒë·∫øn
          B√† N√† Hills nh∆∞ x·ª© s·ªü c·ªï t√≠ch ‚Äì ƒê√† N·∫µng lu√¥n bi·∫øt c√°ch chinh ph·ª•c tr√°i
          tim du kh√°ch.
        </p>
      </div>

      <div class="text-center mb-4 buttons">
        <button
          class="btn-food active"
          onclick="toggleSection('dacSan', event)"
        >
          ƒê·ªãa danh
        </button>
        <button class="btn-food" onclick="toggleSection('haiSan', event)">
          ƒê·ªãa danh thi√™n nhi√™n
        </button>
        <button class="btn-food" onclick="toggleSection('duongPho', event)">
          ƒê·ªãa danh c√¥ng tr√¨nh ki·∫øn tr√∫c
        </button>
        <button class="btn-food" onclick="toggleSection('Qua', event)">
          ƒê·ªãa danh vƒÉn ho√° - ngh·ªá thu·∫≠t
        </button>
      </div>
      <section class="content-section">
        <div id="DiaDanhDN" class="wrapper"></div>
      </section>
    </section>

    <!-- üåä Footer -->
    <footer class="footer text-light">
      <div class="container py-5">
        <div class="row gy-4">
          <!-- Logo & M√¥ t·∫£ -->
          <div class="col-md-4">
            <h3 class="footer-logo">ƒê√† N·∫µng Travel</h3>
            <p>
              Kh√°m ph√° v·∫ª ƒë·∫πp ƒê√† N·∫µng ‚Äì th√†nh ph·ªë ƒë√°ng s·ªëng nh·∫•t Vi·ªát Nam. Ch√∫ng
              t√¥i mang ƒë·∫øn nh·ªØng tr·∫£i nghi·ªám du l·ªãch ƒë·ªôc ƒë√°o v√† ti·ªán l·ª£i.
            </p>
          </div>

          <!-- Li√™n k·∫øt nhanh -->
          <div class="col-md-4">
            <h5>Li√™n k·∫øt nhanh</h5>
            <ul class="footer-links">
              <li><a href="#about">Gi·ªõi thi·ªáu</a></li>
              <li><a href="diaDanh.html">ƒê·ªãa Danh</a></li>
              <li><a href="nghiDuong.html">Ngh·ªâ D∆∞·ª°ng</a></li>
              <li><a href="Food.html">·∫®m th·ª±c</a></li>
              <li><a href="tour.html">Tour</a></li>
              <li><a href="lienhe.html">Li√™n h·ªá</a></li>
            </ul>
          </div>

          <!-- Li√™n h·ªá & M·∫°ng x√£ h·ªôi -->
          <div class="col-md-4">
            <h5>Li√™n h·ªá</h5>
            <p>
              <i class="fas fa-map-marker-alt"></i> 123 ƒê∆∞·ªùng B·∫°ch ƒê·∫±ng, ƒê√† N·∫µng
            </p>
            <p><i class="fas fa-phone"></i> 0901 234 567</p>
            <p><i class="fas fa-envelope"></i> info@danangtravel.vn</p>

            <div class="social-icons mt-3">
              <a href="#"><i class="fab fa-facebook-f"></i></a>
              <a href="#"><i class="fab fa-instagram"></i></a>
              <a href="#"><i class="fab fa-tiktok"></i></a>
            </div>
          </div>
        </div>
      </div>

      <div class="footer-bottom text-center py-3">
        <p>¬© 2025 ƒê√† N·∫µng Travel. Thi·∫øt k·∫ø b·ªüi <strong>CTV Team</strong>.</p>
      </div>
    </footer>

    <!-- JS -->
    <script>
      // ========= STATE =========
      let diaDanhList = [];
      let isLoggedIn = false; // b·∫°n ƒëang c√≥ check ƒëƒÉng nh·∫≠p ·ªü d∆∞·ªõi

      // ========= LOAD FROM DB =========
      async function loadDiaDanh() {
        try {
          const res = await fetch("diaDanh.php", { cache: "no-store" });
          if (!res.ok) throw new Error("Load failed");
          const data = await res.json();
          // Chu·∫©n h√≥a key ƒë·ªÉ d√πng y h·ªát code c≈©:
          // TenDD -> ten, MoTaDD -> moTa, ImageDD -> anh, LoaiDD -> nhom, MapLinkDD -> map
          diaDanhList = data.map((d) => ({
            id: d.MaDD,
            ten: d.TenDD,
            moTa: d.MoTaDD,
            anh: d.ImageDD,
            nhom: d.LoaiDD, // thiennhien | congtrinh | vanhoa
            map: d.MapLinkDD, // iframe link
            diaChi: d.DiaDanh, // ƒë·ªãa ch·ªâ th·ª±c t·∫ø (n·∫øu c·∫ßn hi·ªÉn th·ªã)
          }));
          renderDiaDanh(diaDanhList);
        } catch (e) {
          console.error(e);
          document.getElementById(
            "DiaDanhDN"
          ).innerHTML = `<div class="alert alert-danger">Kh√¥ng t·∫£i ƒë∆∞·ª£c d·ªØ li·ªáu ƒë·ªãa danh.</div>`;
        }
      }

      // ========= RENDER =========
      function renderDiaDanh(list) {
        const container = document.getElementById("DiaDanhDN");
        container.innerHTML = "";
        list.forEach((diaDanh, index) => {
          const hasMap = !!diaDanh.map;
          const html = `
        <div class="content-box fade-in mb-4" id="item-${index}">
          <div id="media-${index}" class="media-box" data-showing="image">
            <img src="${diaDanh.anh}" alt="${
            diaDanh.ten
          }" class="rounded shadow-sm w-100" />
          </div>


          <div class="text-box mt-3">
            <h5 class="text-center fw-bold">${diaDanh.ten}</h5>
            ${
              diaDanh.diaChi
                ? `<p class="text-center text-muted mb-1"><i class="bi bi-geo-alt"></i> ${diaDanh.diaChi}</p>`
                : ``
            }
            <p class="mo-ta mb-2">${diaDanh.moTa}</p>


            <div class="d-flex justify-content-center gap-3 flex-wrap">
              ${
                hasMap
                  ? `<button class="btn btn-outline-primary nuthanhdong"
                             id="btnMap-${index}"
                             onclick="toggleMap(${index}, '${encodeURIComponent(
                      diaDanh.anh
                    )}', '${encodeURIComponent(diaDanh.map)}')">
                       <i class="bi bi-geo-alt"></i>
                     </button>`
                  : ``
              }
              <button class="btn btn-outline-success nuthanhdong" onclick="handleYeuThich(${
                diaDanh.id || "null"
              })">
                <i class="bi bi-heart"></i>
              </button>
            </div>
          </div>
        </div>
      `;
          container.insertAdjacentHTML("beforeend", html);
        });
      }

      // ========= SEARCH =========
      function searchDiaDanh(e) {
        e.preventDefault();
        const kw = document
          .getElementById("searchInput")
          .value.trim()
          .toLowerCase();
        const filtered = diaDanhList.filter(
          (d) =>
            d.ten.toLowerCase().includes(kw) ||
            d.moTa.toLowerCase().includes(kw) ||
            (d.diaChi && d.diaChi.toLowerCase().includes(kw))
        );
        renderDiaDanh(filtered);
        return false;
      }

      // ========= FILTER BY GROUP =========
      function toggleSection(loai, e) {
        document
          .querySelectorAll(".btn-food")
          .forEach((b) => b.classList.remove("active"));
        e.target.classList.add("active");

        let nhom = "";
        if (loai === "haiSan") nhom = "thiennhien";
        else if (loai === "duongPho") nhom = "congtrinh";
        else if (loai === "Qua") nhom = "vanhoa";
        else nhom = "all";

        const kw = document
          .getElementById("searchInput")
          .value.trim()
          .toLowerCase();
        const filtered = diaDanhList.filter(
          (d) =>
            (nhom === "all" || d.nhom === nhom) &&
            (d.ten.toLowerCase().includes(kw) ||
              d.moTa.toLowerCase().includes(kw) ||
              (d.diaChi && d.diaChi.toLowerCase().includes(kw)))
        );
        renderDiaDanh(filtered);
      }

      // ========= IMG <-> MAP =========
      function toggleMap(index, imgPathEncoded, mapLinkEncoded) {
        const imgPath = decodeURIComponent(imgPathEncoded);
        const mapLink = decodeURIComponent(mapLinkEncoded);
        const mediaDiv = document.getElementById(`media-${index}`);
        const btn = document.getElementById(`btnMap-${index}`);
        const showing = mediaDiv.dataset.showing;

        if (showing === "map") {
          mediaDiv.innerHTML = `<img src="${imgPath}" alt="·∫£nh ƒë·ªãa danh" class="img-fluid rounded shadow-sm" />`;
          mediaDiv.dataset.showing = "image";
          btn.firstElementChild.className = "bi bi-geo-alt";
        } else {
          mediaDiv.innerHTML = `<iframe src="${mapLink}" width="100%" height="350" style="border:0;" allowfullscreen loading="lazy"></iframe>`;
          mediaDiv.dataset.showing = "map";
          btn.firstElementChild.className = "bi bi-image";
        }
      }

      // ========= FAVORITE (t√πy b·∫°n n·ªëi API) =========
      function handleYeuThich(id) {
        if (!isLoggedIn) {
          const goLogin = confirm(
            "B·∫°n c·∫ßn ƒëƒÉng nh·∫≠p ƒë·ªÉ y√™u th√≠ch ƒë·ªãa danh. ƒêi ƒë·∫øn trang ƒëƒÉng nh·∫≠p?"
          );
          if (goLogin) window.location.href = "dangNhap.html";
          return;
        }
        alert("üíñ ƒê√£ th√™m v√†o danh s√°ch y√™u th√≠ch!");
        // TODO: fetch('api_favorite.php', {method:'POST', body: JSON.stringify({diadanh_id:id})})
      }

      // ========= INIT =========
      window.onload = function () {
        loadDiaDanh(); // n·∫°p t·ª´ DB thay cho data c·ª©ng
      };

      document.addEventListener("DOMContentLoaded", () => {
        const loginSection = document.getElementById("login-section");
        const navbarMenu = document.getElementById("navbarMenu");

        fetch("getUser.php")
          .then((res) => res.json())
          .then((data) => {
            if (data.loggedIn) {
              // Thay n·ªôi dung login-section
              loginSection.innerHTML = `
          <a class="login-text" href ="suaHS.html"><i class="bi bi-person-circle me-2 fs-5" ></i>${data.TenTaiKhoan}</a>
          <a href="dangXuat.php" class="login-text ms-3">
            <i class="bi bi-box-arrow-in-right me-2 fs-5"></i>ƒêƒÇNG XU·∫§T
          </a>
        `;

              // Thay menu n·∫øu mu·ªën th√™m m·ª•c Y√™u th√≠ch
              navbarMenu.querySelector("ul.navbar-nav").innerHTML = `
          <li class="nav-item"><a class="nav-link" href="TrangChu.html">TRANG CH·ª¶</a></li>
          <li class="nav-item"><a class="nav-link" href="diaDanh.html">ƒê·ªäA DANH N·ªîI B·∫¨T</a></li>
          <li class="nav-item"><a class="nav-link" href="Food.html">·∫®M TH·ª∞C</a></li>
          <li class="nav-item"><a class="nav-link" href="nghiDuong.html">NGH·ªà D∆Ø·ª†NG</a></li>
          <li class="nav-item"><a class="nav-link" href="tour.html">TOUR</a></li>
          <li class="nav-item"><a class="nav-link" href="YT.html">M·ª§C Y√äU TH√çCH</a></li>
          <li class="nav-item"><a class="nav-link" href="Lichsu.html">L·ªäCH S·ª¨ ƒê·∫∂T TOUR</a></li>
        `;
            }
          });
      });
    </script>
    <script
      src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"
      defer
    ></script>
  </body>
</html>
