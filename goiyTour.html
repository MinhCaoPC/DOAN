<!DOCTYPE html>
<html lang="vi">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>G·ª£i √ù Tour Du L·ªãch - ƒê√† N·∫µng Travel</title>
    
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet" />
    <link href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.3/font/bootstrap-icons.css" rel="stylesheet" />
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.0/css/all.min.css">
    
    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;500;600;700&display=swap" rel="stylesheet">

    <link rel="stylesheet" href="goiyTour.css">
</head>

<body>
    <!-- Navbar -->
  <nav class="navbar navbar-expand-lg navbar-dark navbar-custom fixed-top" id="navbar">
    <div class="container">
      <!-- Logo -->
      <a class="navbar-logo-fixed" href="TrangChu.html">
        <img src="images/logo.png" alt="Logo" class="logo-fixed" />
      </a>

      <!-- Toggler -->
      <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarMenu">
        <span class="navbar-toggler-icon"></span>
      </button>

      <!-- Menu -->
      <div class="collapse navbar-collapse justify-content-center" id="navbarMenu">
        <ul class="navbar-nav">
          <li class="nav-item"><a class="nav-link" href="TrangChu.html">TRANG CH·ª¶</a></li>
          <li class="nav-item">
            <a class="nav-link" href="diaDanh.html">ƒê·ªäA DANH N·ªîI B·∫¨T</a>
          </li>
          <li class="nav-item"><a class="nav-link" href="Food.html">·∫®M TH·ª∞C</a></li>
          <li class="nav-item">
            <a class="nav-link" href="nghiDuong.html">NGH·ªà D∆Ø·ª†NG</a>
          </li>
          <li class="nav-item">
            <a class="nav-link" href="tour.html">TOUR</a>
          </li>
        </ul>


        <div class="login-section" id="login-section">
          <a href="dangNhap.html" class="login-text">
            <i class="bi bi-person-circle me-2 fs-5"></i>ƒêƒÇNG NH·∫¨P
          </a>
        </div>
      </div>
    </div>
  </nav>

    <section class="hero-section">
        <h1 class="main-title"><i class="bi bi-robot me-2"></i>G·ª£i √ù Tour Du L·ªãch</h1>
        <p class="sub-title">Ch·ªçn nh·ªØng ƒëi·ªÅu b·∫°n th√≠ch b√™n d∆∞·ªõi, ch√∫ng t√¥i s·∫Ω t√¨m ki·∫øm nh·ªØng tour du l·ªãch ph√π h·ª£p nh·∫•t d√†nh ri√™ng cho b·∫°n.</p>
    </section>

    <section class="recommendation-container">
        <form id="recommendation-form">
            <div id="dynamic-features" class="feature-group-wrapper">
                <div class="col-12 text-center" id="loading-message">
                    <div class="spinner-border text-warning spinner-border-sm me-2" role="status"></div>
                    ƒêang t·∫£i d·ªØ li·ªáu s·ªü th√≠ch t·ª´ h·ªá th·ªëng...
                </div>
            </div>

            <div class="text-center">
                <button type="submit" id="submit-button" class="btn btn-primary" disabled>
                    <i class="bi bi-stars me-2"></i> T√¨m Tour Ph√π H·ª£p
                </button>
            </div>
        </form>

        <div id="recommendation-results">
            </div>
    </section>

    <footer class="footer text-light">
        <div class="container py-5">
            <div class="row gy-4">
                <div class="col-md-4">
                    <h3 class="footer-logo">ƒê√† N·∫µng Travel</h3>
                    <p>Kh√°m ph√° v·∫ª ƒë·∫πp ƒê√† N·∫µng ‚Äì th√†nh ph·ªë ƒë√°ng s·ªëng nh·∫•t Vi·ªát Nam.</p>
                </div>
                <div class="col-md-4">
                    <h5>Li√™n k·∫øt nhanh</h5>
                    <ul class="footer-links">
                        <li><a href="diaDanh.html">ƒê·ªãa Danh</a></li>
                        <li><a href="nghiDuong.html">Ngh·ªâ D∆∞·ª°ng</a></li>
                        <li><a href="Food.html">·∫®m th·ª±c</a></li>
                        <li><a href="tour.html">Tour</a></li>
                    </ul>
                </div>
                <div class="col-md-4">
                    <h5>Li√™n h·ªá</h5>
                    <p><i class="fas fa-phone me-2"></i> 0901 234 567</p>
                    <div class="social-icons mt-3">
                        <a href="#"><i class="fab fa-facebook-f"></i></a>
                        <a href="#"><i class="fab fa-tiktok"></i></a>
                    </div>
                </div>
            </div>
        </div>
        <div class="footer-bottom text-center py-3">
            <p>¬© 2025 ƒê√† N·∫µng Travel. Thi·∫øt k·∫ø b·ªüi <strong>CTV Team</strong>.</p>
        </div>
    </footer>

    <a href="lienhe.html" class="floating-btn" title="B·∫°n c·∫ßn t∆∞ v·∫•n?">
        <i class="bi bi-phone"></i>
        <span class="tooltip-text">B·∫°n c·∫ßn t∆∞ v·∫•n?</span>
    </a>

    <script>
        const recommendationForm = document.getElementById('recommendation-form');
        const dynamicFeatures = document.getElementById('dynamic-features');
        const submitButton = document.getElementById('submit-button');
        const resultsDiv = document.getElementById('recommendation-results');
        const loginSection = document.getElementById('login-section');

        function loadFeatures() {
            fetch('goiyTour.php?action=get_features')
            .then(response => response.json())
            .then(data => {
                if (data.success && data.features) {
                    let html = '';
                    const features = data.features;
                    
                    for (const key in features) {
                        const featureData = features[key];
                        if (featureData.error) continue;

                        html += `<div class="feature-group">`;
                        html += `<h2>${featureData.emoji} ${featureData.title}</h2>`;
                        
                        if (featureData.items.length === 0) {
                            html += `<p class="text-muted small">Ch∆∞a c√≥ d·ªØ li·ªáu.</p>`;
                        } else {
                            featureData.items.forEach(item => {
                                // S·ª≠a l·∫°i m·ªôt ch√∫t HTML ·ªü ƒë√¢y ƒë·ªÉ kh·ªõp v·ªõi CSS m·ªõi
                                html += `<label><input type='checkbox' name='${key}[]' value='${item.id}'> ${item.name}</label>`;
                            });
                        }
                        html += `</div>`;
                    }

                    dynamicFeatures.innerHTML = html;
                    submitButton.disabled = false;
                    
                } else {
                    dynamicFeatures.innerHTML = `<p class="text-danger text-center">Kh√¥ng th·ªÉ t·∫£i d·ªØ li·ªáu.</p>`;
                }
            })
            .catch(error => {
                dynamicFeatures.innerHTML = `<p class="text-danger text-center">L·ªói k·∫øt n·ªëi server.</p>`;
            });
        }
        
        recommendationForm.addEventListener('submit', function(e) {
            e.preventDefault();
            
            const formData = new FormData(recommendationForm);
            const data = { action: 'recommend' }; 

            formData.forEach((value, key) => {
                if (key.endsWith('[]')) {
                    const cleanKey = key.slice(0, -2);
                    if (!data[cleanKey]) { data[cleanKey] = []; }
                    data[cleanKey].push(value);
                }
            });

            resultsDiv.innerHTML = '<div class="text-center py-5"><div class="spinner-border text-primary mb-3" role="status"></div><p class="text-muted">ƒêang ph√¢n t√≠ch s·ªü th√≠ch c·ªßa b·∫°n...</p></div>';

            fetch('goiyTour.php', {
                method: 'POST',
                headers: { 'Content-Type': 'application/json' },
                body: JSON.stringify(data),
            })
            .then(response => response.json())
            .then(tours => {
                resultsDiv.innerHTML = ''; 

                if (Array.isArray(tours)) {
                    if (tours.length > 0) {
                        let html = '<h3 class="text-center mb-4" style="color:var(--primary-dark)">üåü K·∫øt Qu·∫£ G·ª£i √ù Cho B·∫°n</h3><div class="tour-list">';
                        tours.forEach((tour, index) => {
                            html += `
                                <div class="tour-item">
                                    <div>
                                        <strong><a href="tour.html#item-tour-${tour.MaTour}">Tour ${index + 1}: ${tour.TenTour}</a></strong>
                                    </div>
                                    <div class="score-info">
                                        <span class="text-muted"><i class="bi bi-bar-chart-fill me-1"></i> ƒêi·ªÉm s·ªë: ${tour.DiemTuongDong}</span>
                                        <div class="match-badge">${tour.TyLeTuongDong}% Ph√π h·ª£p</div>
                                    </div>
                                </div>
                            `;
                        });
                        html += '</div>';
                        resultsDiv.innerHTML = html;
                    } else {
                        resultsDiv.innerHTML = '<div class="alert alert-warning text-center">Kh√¥ng t√¨m th·∫•y tour ph√π h·ª£p. H√£y th·ª≠ ch·ªçn nhi·ªÅu m·ª•c h∆°n nh√©!</div>';
                    }
                } else if (tours.error) {
                     resultsDiv.innerHTML = `<p class="text-center text-danger">L·ªói: ${tours.error}</p>`;
                }
            })
            .catch(error => {
                resultsDiv.innerHTML = `<p class="text-center text-danger">L·ªói k·∫øt n·ªëi.</p>`;
            });
        });

        document.addEventListener('DOMContentLoaded', () => {
            loadFeatures();
            fetch("getUser.php")
                .then((res) => res.json())
                .then((data) => {
                    if (data.loggedIn) {
            // Thay n·ªôi dung login-section
            loginSection.innerHTML = `
          
          <a class="login-text" href ="suaHS.html"><i class="bi bi-person-circle me-2 fs-5" ></i>${data.TenTaiKhoan}</a>
          <a href="dangXuat.php" class="login-text ms-3">
            <i class="bi bi-box-arrow-in-right me-2 fs-5"></i>ƒêƒÇNG XU·∫§T
          </a>
        `;

            // Thay menu n·∫øu mu·ªën th√™m m·ª•c Y√™u th√≠ch
            navbarMenu.querySelector('ul.navbar-nav').innerHTML = `
          <li class="nav-item"><a class="nav-link active" href="TrangChu.html">TRANG CH·ª¶</a></li>
          <li class="nav-item"><a class="nav-link" href="diaDanh.html">ƒê·ªäA DANH N·ªîI B·∫¨T</a></li>
          <li class="nav-item"><a class="nav-link" href="Food.html">·∫®M TH·ª∞C</a></li>
          <li class="nav-item"><a class="nav-link" href="nghiDuong.html">NGH·ªà D∆Ø·ª†NG</a></li>
          <li class="nav-item"><a class="nav-link" href="tour.html">TOUR</a></li>
          <li class="nav-item"><a class="nav-link" href="YT.html">M·ª§C Y√äU TH√çCH</a></li>
          <li class="nav-item"><a class="nav-link" href="Lichsu.html">L·ªäCH S·ª¨ ƒê·∫∂T TOUR</a></li>
        `;
          }
                });
        
        });
    </script>
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"></script>
</body>
</html>