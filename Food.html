<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>·∫®m th·ª±c ƒê√† N·∫µng</title>
  <!-- Bootstrap -->
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet" />
  <link href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.3/font/bootstrap-icons.css" rel="stylesheet" />

  <!-- CSS ri√™ng -->
  <link rel="stylesheet" href="Food.css" />
</head>

<body>
  <!-- Navbar -->
  <nav class="navbar navbar-expand-lg navbar-dark navbar-custom fixed-top">
    <div class="container">
      <!-- Logo -->
      <a class="navbar-logo-fixed" href="#">
        <img src="images/logo.png" alt="Logo" class="logo-fixed" />
      </a>

      <!-- Toggler -->
      <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarMenu">
        <span class="navbar-toggler-icon"></span>
      </button>

      <!-- Menu -->
      <div class="collapse navbar-collapse justify-content-center" id="navbarMenu">
        <ul class="navbar-nav">
          <li class="nav-item"><a class="nav-link" href="TrangChu.html">TRANG CH·ª¶</a></li>
          <li class="nav-item">
            <a class="nav-link" href="diaDanh.html">ƒê·ªäA DANH N·ªîI B·∫¨T</a>
          </li>
          <li class="nav-item"><a class="nav-link" href="Food.html">·∫®M TH·ª∞C</a></li>
          <li class="nav-item">
            <a class="nav-link" href="nghiDuong.html">NGH·ªà D∆Ø·ª†NG</a>
          </li>
          <li class="nav-item">
            <a class="nav-link" href="tour.html">TOUR</a>
          </li>
        </ul>

        <div class="login-section" id="login-section">
          <a href="dangNhap.html" class="login-text">
            <i class="bi bi-person-circle me-2 fs-5"></i>ƒêƒÇNG NH·∫¨P
          </a>
        </div>
      </div>
    </div>
  </nav>

  <!-- Banner -->
  <section class="banner-section">
    <img src="pic/BANNER.JPG" alt="banner" class="banner-img" />
    <div class="search-container position-absolute top-50 start-50 translate-middle text-center">
      <form class="search-form position-relative d-inline-block" onsubmit="return searchMonAn(event)">
        <input id="searchInput" type="text" class="form-control search-input" placeholder="T√¨m ki·∫øm ƒë·ªãa danh..." />
        <button class="btn-search" type="submit">
          <i class="bi bi-search"></i>
        </button>
      </form>
    </div>
  </section>
  <!-- Gi·ªõi thi·ªáu ·∫©m th·ª±c -->
  <div class="container-fluid text-center Loangmau">
    <div class="row align-items-center">
      <!-- H√¨nh tr√°i -->
      <div class="col-12 col-md-3 d-none d-md-block">
        <img src="pic/2.png" alt="food" class="img-fluid" />
      </div>

      <!-- Text gi·ªØa -->
      <div class="col-12 col-md-6 gt-text">
        <h2 class="chutd">
          KH√ÅM PH√Å <br />
          THI√äN ƒê∆Ø·ªúNG ·∫®M TH·ª∞C ƒê√Ä N·∫¥NG
        </h2>
        <p class="chu danang-desc">
          ƒê√† N·∫µng, trung t√¢m du l·ªãch mi·ªÅn Trung, kh√¥ng ch·ªâ h·∫•p d·∫´n v·ªõi c·∫£nh
          quan tuy·ªát ƒë·∫πp m√† c√≤n b·ªüi n·ªÅn ·∫©m th·ª±c ƒëa d·∫°ng. ·∫®m th·ª±c n∆°i ƒë√¢y l√† s·ª±
          k·∫øt h·ª£p tinh t·∫ø gi·ªØa n√©t c·∫ßu k·ª≥ c·ªßa Hu·∫ø v√† m·ªôc m·∫°c c·ªßa x·ª© Qu·∫£ng, t·ª´
          m√≥n ƒÉn ƒë∆∞·ªùng ph·ªë n·ªïi ti·∫øng nh∆∞ M√¨ Qu·∫£ng, B√°nh tr√°ng cu·ªën th·ªãt heo,
          ƒë·∫øn h·∫£i s·∫£n t∆∞∆°i ngon ven bi·ªÉn. M·ªói m√≥n ƒÉn ƒë·ªÅu k·ªÉ c√¢u chuy·ªán vƒÉn h√≥a
          v√† cam k·∫øt ch·∫•t l∆∞·ª£ng, m·ªùi du kh√°ch kh√°m ph√° h∆∞∆°ng v·ªã ƒë·∫∑c s·∫Øc c·ªßa
          th√†nh ph·ªë.
        </p>
      </div>

      <!-- H√¨nh ph·∫£i -->
      <div class="col-12 col-md-3 d-none d-md-block">
        <img src="pic/1.png" alt="food" class="img-fluid" />
      </div>
    </div>

    <!-- N√öT -->
    <div class="text-center mb-4 buttons">
      <button class="btn-food active" onclick="toggleSection('dacSan', event)">ƒê·∫∑c s·∫£n</button>
      <button class="btn-food" onclick="toggleSection('haiSan', event)">H·∫£i s·∫£n</button>
      <button class="btn-food" onclick="toggleSection('duongPho', event)">ƒê∆∞·ªùng ph·ªë</button>
      <button class="btn-food" onclick="toggleSection('Qua', event)">Qu√† t·∫∑ng ng∆∞·ªùi th√¢n</button>
    </div>


    <!-- CH·ªà GI·ªÆ KH·ªêI N√ÄY, KH√îNG B·ªåC TRONG .content-section -->
    <div id="MonAnDN" class="wrapper"></div>


    <!-- (t√πy ch·ªçn) gi·ªØ c√°c section r·ªóng ƒë·ªÉ hi·ªÉn th·ªã th√¥ng b√°o, NH∆ØNG ƒë·ªÉ ri√™ng v√† ƒëang ·∫©n -->
    <section id="dacSan" class="content-section" style="display:none"></section>
    <section id="haiSan" class="content-section" style="display:none"></section>
    <section id="duongPho" class="content-section" style="display:none"></section>
    <section id="Qua" class="content-section" style="display:none"></section>

    <!-- Ph·∫ßn 2 -->
    <div class="center kc">
      <h2 class="chutd">KH√îNG GIAN V√Ä PHONG C√ÅCH TH∆Ø·ªûNG TH·ª®C</h2>
    </div>


    <!-- ‚úÖ List Ph·∫ßn 2 s·∫Ω render b·∫±ng JS -->
    <div id="ThuongThucList"></div>













  </div>

  <!-- üåä Footer -->
  <footer class="footer text-light">
    <div class="container py-5">
      <div class="row gy-4">

        <!-- Logo & M√¥ t·∫£ -->
        <div class="col-md-4">
          <h3 class="footer-logo">ƒê√† N·∫µng Travel</h3>
          <p>Kh√°m ph√° v·∫ª ƒë·∫πp ƒê√† N·∫µng ‚Äì th√†nh ph·ªë ƒë√°ng s·ªëng nh·∫•t Vi·ªát Nam.
            Ch√∫ng t√¥i mang ƒë·∫øn nh·ªØng tr·∫£i nghi·ªám du l·ªãch ƒë·ªôc ƒë√°o v√† ti·ªán l·ª£i.</p>
        </div>

        <!-- Li√™n k·∫øt nhanh -->
        <div class="col-md-4">
          <h5>Li√™n k·∫øt nhanh</h5>
          <ul class="footer-links">
            <li><a href="#about">Gi·ªõi thi·ªáu</a></li>
            <li><a href="diaDanh.html">ƒê·ªãa Danh</a></li>
            <li><a href="nghiDuong.html">Ngh·ªâ D∆∞·ª°ng</a></li>
            <li><a href="Food.html">·∫®m th·ª±c</a></li>
            <li><a href="tour.html">Tour</a></li>
            <li><a href="lienhe.html">Li√™n h·ªá</a></li>
          </ul>
        </div>

        <!-- Li√™n h·ªá & M·∫°ng x√£ h·ªôi -->
        <div class="col-md-4">
          <h5>Li√™n h·ªá</h5>
          <p><i class="fas fa-map-marker-alt"></i> 123 ƒê∆∞·ªùng B·∫°ch ƒê·∫±ng, ƒê√† N·∫µng</p>
          <p><i class="fas fa-phone"></i> 0901 234 567</p>
          <p><i class="fas fa-envelope"></i> info@danangtravel.vn</p>

          <div class="social-icons mt-3">
            <a href="#"><i class="fab fa-facebook-f"></i></a>
            <a href="#"><i class="fab fa-instagram"></i></a>
            <a href="#"><i class="fab fa-tiktok"></i></a>
          </div>
        </div>
      </div>
    </div>

    <div class="footer-bottom text-center py-3">
      <p>¬© 2025 ƒê√† N·∫µng Travel. Thi·∫øt k·∫ø b·ªüi <strong>CTV Team</strong>.</p>
    </div>
  </footer>
  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"></script>
  <script>
    isLoggedIn = false;
    // ======= STATE =======
    let allItems = [];          // to√†n b·ªô t·ª´ DB
    let listPhan1 = [];         // != 'thuongthuc'
    let listThuongThuc = [];    // == 'thuongthuc'
    let currentGroup = 'dacSan'; // m·∫∑c ƒë·ªãnh n√∫t ƒë·∫ßu ti√™n

    // ‚≠ê 1. (M·ªöI) T√ÅCH H√ÄM SCROLL C·ª¶A B·∫†N RA RI√äNG
    function handleHashScroll() {
      const hash = window.location.hash; // L·∫•y #item-monan-1
      if (hash) {
        // Ch·ªù 1 ch√∫t ƒë·ªÉ DOM render xong
        setTimeout(() => {
          const targetElement = document.querySelector(hash); // T√¨m ph·∫ßn t·ª≠
          if (targetElement) {
            // N·∫øu t√¨m th·∫•y, cu·ªôn m∆∞·ª£t ƒë·∫øn n√≥
            targetElement.scrollIntoView({ behavior: 'smooth', block: 'start' });
            
            // (Th√™m) Hi·ªáu ·ª©ng highlight
            targetElement.style.transition = 'box-shadow 0.3s ease-in-out';
            targetElement.style.boxShadow = '0 0 15px 5px rgba(0, 123, 255, 0.7)';
            setTimeout(() => {
                targetElement.style.boxShadow = 'none';
            }, 2000); // T·∫Øt hi·ªáu ·ª©ng sau 2 gi√¢y
          }
        }, 300); // Ch·ªù 300ms
      }
    }

    // ======= LOAD FROM DB =======
    async function loadMonAn() {
      try {
        const res = await fetch('Food.php', { cache: 'no-store' });
        if (!res.ok) throw new Error('Load failed');
        const data = await res.json();


        // Chu·∫©n h√≥a key cho d·ªÖ d√πng ·ªü d∆∞·ªõi
        allItems = (data || []).map(d => ({
          id: d.MaMonAn,
          ten: d.TenMonAn,
          moTa: d.MoTaMonAn,
          diaChi: d.DiaChiMonAn,
          gia: d.GiaMonAn,
          anh: d.ImageLinkMonAn,
          nhom: d.LoaiMonAn,        // 'dacSan' | 'haiSan' | 'duongPho' | 'dacSanQua' | 'thuongthuc'
          map: d.MapLinkMonAn       // iframe link
        }));


        listThuongThuc = allItems.filter(x => x.nhom === 'thuongthuc');
        listPhan1 = allItems.filter(x => x.nhom !== 'thuongthuc');


        renderMonAn();            // v·∫Ω Ph·∫ßn 1
        renderThuongThuc();       // v·∫Ω Ph·∫ßn 2
        
        // ‚≠ê 2. (THAY ƒê·ªîI) G·ªçi h√†m scroll m·ªõi (ƒë√¢y l√† code c≈© c·ªßa b·∫°n)
        handleHashScroll(); 

      } catch (err) {
        console.error(err);
        document.getElementById('MonAnDN').innerHTML =
          `<div class="alert alert-danger">Kh√¥ng t·∫£i ƒë∆∞·ª£c d·ªØ li·ªáu m√≥n ƒÉn.</div>`;
      }
    }


    // ======= RENDER PH·∫¶N 1 =======
    function renderMonAn(listOverride) {
      const container = document.getElementById('MonAnDN');
      const kwEl = document.getElementById('searchInput');
      const kw = (kwEl?.value || '').trim().toLowerCase();

      // ... (code filter c·ªßa b·∫°n) ...
      let items = Array.isArray(listOverride) ? listOverride : listPhan1;
      items = items.filter(d =>
        (currentGroup === 'all' || d.nhom === currentGroup) &&
        (
          kw === '' ||
          (d.ten && d.ten.toLowerCase().includes(kw)) ||
          (d.moTa && d.moTa.toLowerCase().includes(kw))
        )
      );

      container.innerHTML = '';
      if (items.length === 0) {
        container.innerHTML = `<p class="text-center text-muted">Kh√¥ng c√≥ m√≥n n√†o ph√π h·ª£p.</p>`;
        return;
      }


      items.forEach((it, idx) => {
        const hasMap = !!it.map;
        
        // ‚≠ê 3. (S·ª¨A L·ªñI) S·ª≠a 'item-dd-' th√†nh 'item-monan-'
        const html = `
        <div class="content-box fade-in mb-4" id="item-monan-${it.id}"> 
          <div id="media-${idx}" class="media-box" data-showing="image">
        
        <img src="${it.anh}" alt="${it.ten}" class="media-img rounded shadow-sm" />
          </div>
          <div class="text-box mt-3">
            <h5 class="text-center fw-bold">${it.ten || ''}</h5>
            ${it.moTa ? `<p class="mo-ta mb-2">${it.moTa}</p>` : ''}
            ${it.diaChi ? `<p class="mo-ta mb-2">${it.diaChi}</p>` : ''}
            ${it.gia ? `<p class="mo-ta mb-2">${it.gia}</p>` : ''}
          </div>
          <div class="actions-fixed">
            ${hasMap ? `
              <button class="btn-action btn-icon btn-map" id="btnMap-${idx}"
                      title="Xem b·∫£n ƒë·ªì / ·∫£nh"
                      onclick="toggleMap(${idx}, '${encodeURIComponent(it.anh)}', '${encodeURIComponent(it.map)}')">
                <i class="bi bi-geo-alt"></i>
              </button>` : ''
          }
            <button class="btn-action btn-fav" onclick="handleYeuThich(${it.id})" title="Y√™u th√≠ch">
              <i class="bi bi-heart"></i>
            </button>
          </div>
        </div>`;
        container.insertAdjacentHTML('beforeend', html);
      });
    }

    // ... (Gi·ªØ nguy√™n c√°c h√†m: toggleMap, searchMonAn, toggleSection) ...
    function toggleMap(index, imgPathEncoded, mapLinkEncoded) {
      const imgPath = decodeURIComponent(imgPathEncoded);
      const mapLink = decodeURIComponent(mapLinkEncoded);
      const mediaDiv = document.getElementById(`media-${index}`);
      const btn = document.getElementById(`btnMap-${index}`);
      if (!mediaDiv) return;


      const showing = mediaDiv.dataset.showing;
      if (showing === 'map') {
        mediaDiv.innerHTML = `<img src="${imgPath}" alt="·∫£nh" class="media-img rounded shadow-sm">`;
        mediaDiv.dataset.showing = 'image';
        btn?.firstElementChild && (btn.firstElementChild.className = 'bi bi-geo-alt');
      } else {
        mediaDiv.innerHTML = `<iframe src="${mapLink}" width="100%" height="100%" style="border:0;" allowfullscreen loading="lazy"></iframe>`;
        mediaDiv.dataset.showing = 'map';
        btn?.firstElementChild && (btn.firstElementChild.className = 'bi bi-image');
      }
    }
    function searchMonAn(e) {
      e?.preventDefault?.();
      renderMonAn();
      return false;
    }
    function toggleSection(loai, e) {
      document.querySelectorAll('.btn-food').forEach(b => b.classList.remove('active'));
      e?.target?.classList?.add('active');


      if (loai === 'haiSan') currentGroup = 'haiSan';
      else if (loai === 'duongPho') currentGroup = 'duongPho';
      else if (loai === 'Qua') currentGroup = 'dacSanQua';
      else currentGroup = 'dacSan';


      renderMonAn();
    }


    // ======= PH·∫¶N 2: TH∆Ø·ªûNG TH·ª®C (Code c·ªßa b·∫°n ƒë√£ ƒë√∫ng) =======
    function renderThuongThuc() {
      const wrap = document.getElementById('ThuongThucList');
      if (!wrap) return;

      wrap.innerHTML = '';
      if (listThuongThuc.length === 0) {
        wrap.innerHTML = `<p class="text-center text-muted">Ch∆∞a c√≥ d·ªØ li·ªáu kh√¥ng gian & phong c√°ch th∆∞·ªüng th·ª©c.</p>`;
        return;
      }

      listThuongThuc.forEach((p, idx) => {
        const hasMap = !!p.map;
        // D√≤ng n√†y ƒë√£ ƒë√∫ng: id="item-monan-${p.id}"
        const html = `
        <div class="info-box" id="item-monan-${p.id}"> 
          <div id="tt-media-${idx}" class="info-image" data-showing="image">
            <img src="${p.anh}" alt="${p.ten || ''}" />
          </div>
          <div class="info-content">
            <h5 class="text-center"><b>${p.ten || ''}</b></h5>
            ${p.diaChi ? `<p><b>ƒê·ªãa ch·ªâ:</b> ${p.diaChi}</p>` : ''}
            ${p.gia ? `<p><b>Gi√° tham kh·∫£o:</b> ${p.gia}</p>` : ''}
            <p>${p.moTa || ''}</p>
          </div>
          <div class="actions-fixed">
            ${hasMap ? `
              <button class="btn-action btn-icon btn-map" id="tt-btnMap-${idx}"
                      title="Xem b·∫£n ƒë·ªì / ·∫£nh"
                      onclick="toggleMapTT(${idx}, '${encodeURIComponent(p.anh)}', '${encodeURIComponent(p.map)}')">
                <i class="bi bi-geo-alt"></i>
              </button>` : ''
          }
            <button class="btn-action btn-fav" onclick="handleYeuThich(${p.id})" title="Y√™u th√≠ch">
              <i class="bi bi-heart"></i>
            </button>
          </div>
        </div>`;
        wrap.insertAdjacentHTML('beforeend', html);
      });
    }

    // ... (Gi·ªØ nguy√™n c√°c h√†m: toggleMapTT, handleYeuThich) ...
    function toggleMapTT(index, imgPathEncoded, mapLinkEncoded) {
      const imgPath = decodeURIComponent(imgPathEncoded);
      const mapLink = decodeURIComponent(mapLinkEncoded);
      const mediaDiv = document.getElementById(`tt-media-${index}`);
      const btn = document.getElementById(`tt-btnMap-${index}`);
      if (!mediaDiv) return;


      const showing = mediaDiv.dataset.showing;
      if (showing === 'map') {
        mediaDiv.innerHTML = `<img src="${imgPath}" alt="·∫£nh ƒë·ªãa ƒëi·ªÉm" />`;
        mediaDiv.dataset.showing = 'image';
        btn?.firstElementChild && (btn.firstElementChild.className = 'bi bi-geo-alt');
      } else {
        mediaDiv.innerHTML = `<iframe src="${mapLink}" width="100%" height="100%" style="border:0;" allowfullscreen loading="lazy"></iframe>`;
        mediaDiv.dataset.showing = 'map';
        btn?.firstElementChild && (btn.firstElementChild.className = 'bi bi-image');
      }
    }
    async function handleYeuThich(id) {
      if (!isLoggedIn) {
        const goLogin = confirm("Vui l√≤ng ƒëƒÉng nh·∫≠p ƒë·ªÉ th√™m ƒë·ªãa danh v√†o y√™u th√≠ch!");
        if (goLogin) window.location.href = "dangNhap.html";
        return;

      }
      try {
        const res = await fetch("YT.php", {
          method: "POST",
          headers: {
            "Content-Type": "application/json",
          },
          body: JSON.stringify({
            action: "add",
            loai: "MONAN",
            id: id,
          }),
        });
        const data = await res.json();
        if (data.needLogin) {
          alert("Phi√™n ƒëƒÉng nh·∫≠p ƒë√£ h·∫øt h·∫°n. Vui l√≤ng ƒëƒÉng nh·∫≠p!");
          window.location.href = "dangNhap.html";
          return;
        }
        if (data.success) {
          alert(data.message || "ƒê√£ th√™m v√†o m·ª•c y√™u th√≠ch!");
        } else {
          alert(data.message || "M·ª•c n√†y ƒë√£ c√≥ trong m·ª•c y√™u th√≠ch!");
        }
      }
      catch (err) {
        console.error(err);
        alert("ƒê√£ c√≥ l·ªói x·∫£y ra. Vui l√≤ng th·ª≠ l·∫°i sau!");
      }
    }

    // ======= INIT (S·ª¨A L·∫†I) =======
    document.addEventListener('DOMContentLoaded', () => {
      // ƒë√°nh d·∫•u n√∫t ƒë·∫ßu ti√™n active
      document.querySelector('.btn-food')?.classList.add('active');
      
      // n·∫°p d·ªØ li·ªáu
      loadMonAn();

      // ‚≠ê 4. (M·ªöI) TH√äM TAI NGHE 'hashchange'
      // ƒê√¢y l√† m·∫•u ch·ªët ƒë·ªÉ ch·∫°y l·∫°i khi click link l·∫ßn 2
      window.addEventListener('hashchange', handleHashScroll);
    });

    // (Gi·ªØ nguy√™n code login c·ªßa b·∫°n)
    document.addEventListener("DOMContentLoaded", () => {
      const loginSection = document.getElementById('login-section');
      const navbarMenu = document.getElementById('navbarMenu');

      fetch('getUser.php')
        .then(res => res.json())
        .then(data => {
          if (data.loggedIn) {
            isLoggedIn = true;
            // ... (code innerHTML) ...
            loginSection.innerHTML = `
              <a class="login-text" href ="suaHS.html"><i class="bi bi-person-circle me-2 fs-5" ></i>${data.TenTaiKhoan}</a>
              <a href="dangXuat.php" class="login-text ms-3">
                <i class="bi bi-box-arrow-in-right me-2 fs-5"></i>ƒêƒÇNG XU·∫§T
              </a>
            `;
            navbarMenu.querySelector('ul.navbar-nav').innerHTML = `
              <li class="nav-item"><a class="nav-link" href="TrangChu.html">TRANG CH·ª¶</a></li>
              <li class="nav-item"><a class="nav-link" href="diaDanh.html">ƒê·ªäA DANH N·ªîI B·∫¨T</a></li>
              <li class="nav-item"><a class="nav-link" href="Food.html">·∫®M TH·ª∞C</a></li>
              <li class="nav-item"><a class="nav-link" href="nghiDuong.html">NGH·ªà D∆Ø·ª†NG</a></li>
              <li class="nav-item"><a class="nav-link" href="tour.html">TOUR</a></li>
              <li class="nav-item"><a class="nav-link" href="YT.html">M·ª§C Y√äU TH√çCH</a></li>
              <li class="nav-item"><a class="nav-link" href="Lichsu.html">L·ªäCH S·ª¨ ƒê·∫∂T TOUR</a></li>
            `;
          }
        });
    });
  </script>
</body>
</html>

