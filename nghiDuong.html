<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Ngh·ªâ d∆∞·ª°ng</title>
  <!-- Bootstrap -->
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet" />
  <link href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.3/font/bootstrap-icons.css" rel="stylesheet" />

  <!-- CSS ri√™ng -->
  <link rel="stylesheet" href="nghiDuong.css" />
</head>

<body>
  <!-- Navbar -->
  <nav class="navbar navbar-expand-lg navbar-dark navbar-custom fixed-top">
    <div class="container">
      <!-- Logo -->
      <a class="navbar-logo-fixed" href="#">
        <img src="images/logo.png" alt="Logo" class="logo-fixed" />
      </a>

      <!-- Toggler -->
      <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarMenu">
        <span class="navbar-toggler-icon"></span>
      </button>

      <!-- Menu -->
      <div class="collapse navbar-collapse justify-content-center" id="navbarMenu">
        <ul class="navbar-nav">
          <li class="nav-item"><a class="nav-link" href="TrangChu.html">TRANG CH·ª¶</a></li>
          <li class="nav-item">
            <a class="nav-link" href="diaDanh.html">ƒê·ªäA DANH N·ªîI B·∫¨T</a>
          </li>
          <li class="nav-item"><a class="nav-link" href="Food.html">·∫®M TH·ª∞C</a></li>
          <li class="nav-item">
            <a class="nav-link" href="nghiDuong.html">NGH·ªà D∆Ø·ª†NG</a>
          </li>
          <li class="nav-item">
            <a class="nav-link" href="tour.html">TOUR</a>
          </li>
        </ul>

        <div class="login-section" id="login-section">
          <a href="dangNhap.html" class="login-text">
            <i class="bi bi-person-circle me-2 fs-5"></i>ƒêƒÇNG NH·∫¨P
          </a>
        </div>
      </div>
    </div>
  </nav>

  <!-- Banner -->
  <!-- Banner -->
  <section id="banner" class="position-relative text-center text-light">
    <img src="anh/bannernghiduong.jpg" alt="Banner" class="banner-img w-100" />
    <div class="banner-overlay"></div>

    <!-- Thanh t√¨m ki·∫øm -->
    <div class="search-container position-absolute top-50 start-50 translate-middle text-center">

      <form class="search-form position-relative " onsubmit="return searchKND(event)">

        <input id="searchInput" type="text" class="form-control search-input" placeholder="T√¨m ki·∫øm ngh·ªâ d∆∞·ª°ng..."
          autocomplete="off" />

        <button class="btn-search" type="submit">
          <i class="bi bi-search"></i>
        </button>

        <div id="suggestionsBox" class="list-group position-absolute w-100 shadow"></div>

      </form>
    </div>
  </section>

  <!-- Gi·ªõi thi·ªáu + Ph√¢n lo·∫°i -->
  <section id="diadanh" class="diadanh-section">
    <div class="intro danang-desc ">
      <p>
        N·∫±m ngay trung t√¢m d·∫£i ƒë·∫•t h√¨nh ch·ªØ S, ƒê√† N·∫µng kh√¥ng ch·ªâ l√† ‚Äúth√†nh ph·ªë
        ƒë√°ng s·ªëng nh·∫•t Vi·ªát Nam‚Äù m√† c√≤n l√† m·ªôt c·ªïng ng√µ tr·∫£i nghi·ªám kh√¥ng
        ng·ª´ng ngh·ªâ.
        <br /><br />
        N∆°i ƒë√¢y h·ªôi t·ª• m·ªôt b·∫£n giao h∆∞·ªüng h√†i h√≤a: v·∫ª ƒë·∫πp h√πng vƒ© c·ªßa b√°n ƒë·∫£o
        S∆°n Tr√†, s·ª± quy·∫øn r≈© c·ªßa b√£i bi·ªÉn M·ªπ Kh√™, s·ª± l√£ng m·∫°n c·ªßa s√¥ng H√†n v√†
        nh·ªãp s·ªëng ƒë√¥ th·ªã th√¥ng minh, hi·ªán ƒë·∫°i. T·ª´ C·∫ßu R·ªìng phun l·ª≠a r·ª±c r·ª° ƒë·∫øn
        B√† N√† Hills nh∆∞ x·ª© s·ªü c·ªï t√≠ch ‚Äì ƒê√† N·∫µng lu√¥n bi·∫øt c√°ch chinh ph·ª•c tr√°i
        tim du kh√°ch.
      </p>
    </div>

    <div class="text-center mb-4 buttons">
      <button class="btn-food active" onclick="toggleSection('dacSan', event)">
        T·∫•t c·∫£
      </button>
      <button class="btn-food" onclick="toggleSection('haiSan', event)">
        Vui ch∆°i, gi·∫£i tr√≠
      </button>
      <button class="btn-food" onclick="toggleSection('duongPho', event)">
        Ngh·ªâ d∆∞·ª°ng, kh√°ch s·∫°n
      </button>
      <button class="btn-food" onclick="toggleSection('Qua', event)">
        Khu sinh th√°i
      </button>
    </div>
    <section class="content-section">
      <div id="DiaDanhDN" class="wrapper"></div>
    </section>
  </section>

  <!-- üåä Footer -->
  <footer class="footer text-light">
    <div class="container py-5">
      <div class="row gy-4">

        <!-- Logo & M√¥ t·∫£ -->
        <div class="col-md-4">
          <h3 class="footer-logo">ƒê√† N·∫µng Travel</h3>
          <p>Kh√°m ph√° v·∫ª ƒë·∫πp ƒê√† N·∫µng ‚Äì th√†nh ph·ªë ƒë√°ng s·ªëng nh·∫•t Vi·ªát Nam.
            Ch√∫ng t√¥i mang ƒë·∫øn nh·ªØng tr·∫£i nghi·ªám du l·ªãch ƒë·ªôc ƒë√°o v√† ti·ªán l·ª£i.</p>
        </div>

        <!-- Li√™n k·∫øt nhanh -->
        <div class="col-md-4">
          <h5>Li√™n k·∫øt nhanh</h5>
          <ul class="footer-links">
            <li><a href="#about">Gi·ªõi thi·ªáu</a></li>
            <li><a href="diaDanh.html">ƒê·ªãa Danh</a></li>
            <li><a href="nghiDuong.html">Ngh·ªâ D∆∞·ª°ng</a></li>
            <li><a href="Food.html">·∫®m th·ª±c</a></li>
            <li><a href="tour.html">Tour</a></li>
          </ul>
        </div>

        <!-- Li√™n h·ªá & M·∫°ng x√£ h·ªôi -->
        <div class="col-md-4">
          <h5>Li√™n h·ªá</h5>
          <p><i class="fas fa-map-marker-alt"></i> 123 ƒê∆∞·ªùng B·∫°ch ƒê·∫±ng, ƒê√† N·∫µng</p>
          <p><i class="fas fa-phone"></i> 0901 234 567</p>
          <p><i class="fas fa-envelope"></i> info@danangtravel.vn</p>

          <div class="social-icons mt-3">
            <a href="#"><i class="fab fa-facebook-f"></i></a>
            <a href="#"><i class="fab fa-instagram"></i></a>
            <a href="#"><i class="fab fa-tiktok"></i></a>
          </div>
        </div>
      </div>
    </div>

    <div class="footer-bottom text-center py-3">
      <p>¬© 2025 ƒê√† N·∫µng Travel. Thi·∫øt k·∫ø b·ªüi <strong>CTV Team</strong>.</p>
    </div>
  </footer>
  <a href="lienhe.html" class="floating-btn" title="B·∫°n c·∫ßn t∆∞ v·∫•n?" style="bottom: 90px;">
      <i class="bi bi-phone"></i>
      <span class="tooltip-text">B·∫°n c·∫ßn t∆∞ v·∫•n?</span>
    </a>


<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"></script>

<script>
    // ========= STATE (BI·∫æN TO√ÄN C·ª§C) =========
    let kndList = [];     
    let isLoggedIn = false;
    let currentGroup = 'all'; 

    const container = document.getElementById("DiaDanhDN");
    const searchInput = document.getElementById("searchInput");
    const suggestionsBox = document.getElementById("suggestionsBox");
    const loginSection = document.getElementById('login-section');
    const navbarMenu = document.getElementById('navbarMenu');

    // ========= C√ÅC H√ÄM X·ª¨ L√ù =========

    function handleHashScroll() {
      // (H√†m n√†y gi·ªØ nguy√™n)
      const hash = window.location.hash;
      if (hash) {
        setTimeout(() => {
          const targetElement = document.querySelector(hash);
          if (targetElement) {
            targetElement.scrollIntoView({ behavior: 'smooth', block: 'start' });
            targetElement.style.transition = 'box-shadow 0.3s ease-in-out';
            targetElement.style.boxShadow = '0 0 15px 5px rgba(0, 123, 255, 0.7)';
            setTimeout(() => {
                targetElement.style.boxShadow = 'none';
            }, 2000);
          }
        }, 300);
      }
    }

    // ‚≠ê --- H√ÄM loadKND ƒê√É ƒê∆Ø·ª¢C S·ª¨A L·ªñI --- ‚≠ê
    async function loadKND() {
      try {
        const res = await fetch('nghiDuong.php', { cache: 'no-store' }); 
        if (!res.ok) throw new Error(`Fetch th·∫•t b·∫°i (status: ${res.status})`);
        
        const data = await res.json(); 

        // 1. Ki·ªÉm tra xem PHP c√≥ tr·∫£ v·ªÅ 'status: success' kh√¥ng
        if (data.status === 'success' && Array.isArray(data.diaDanhList)) {
            
            // 2. L·∫•y map object t·ª´ PHP
            const mapLinks = data.mapLinks || {};

            // 3. S·ª¨A L·ªñI MAPPING T·∫†I ƒê√ÇY
            // PHP ƒë√£ g·ª≠i c√°c keys (id, ten, moTa, anh, nhom, diaChi)
            // Ch√∫ng ta KH√îNG c·∫ßn .map() n·ªØa, ch·ªâ c·∫ßn th√™m 'map' v√†o
            kndList = data.diaDanhList.map(d => {
                // L·∫•y key file ·∫£nh (v√≠ d·ª•: 'banahills.jpg')
                const fileKey = d.anh ? d.anh.split('/').pop() : '';
                
                // Tr·∫£ v·ªÅ object ho√†n ch·ªânh m√† renderKND() c·∫ßn
                return {
                    id: d.id,
                    ten: d.ten,
                    moTa: d.moTa,
                    anh: d.anh,
                    nhom: d.nhom,      // 'vuichoi', 'nghiduong', 'sinhthai'
                    diaChi: d.diaChi,
                    map: mapLinks[fileKey] || '' // Th√™m map link v√†o
                };
            });
            
            renderKND(kndList); // V·∫Ω t·∫•t c·∫£
            handleHashScroll(); // Ki·ªÉm tra #hash
        } else {
            // PHP tr·∫£ v·ªÅ {status: 'error'} ho·∫∑c ƒë·ªãnh d·∫°ng sai
            throw new Error(data.msg || 'ƒê·ªãnh d·∫°ng d·ªØ li·ªáu tr·∫£ v·ªÅ kh√¥ng ƒë√∫ng.');
        }
      } catch (e) {
        console.error("L·ªói t·∫£i KND:", e);
        container.innerHTML = `<div class="alert alert-danger">L·ªói t·∫£i d·ªØ li·ªáu. (Chi ti·∫øt: ${e.message})</div>`;
      }
    }
    // ‚≠ê --- H·∫æT PH·∫¶N S·ª¨A --- ‚≠ê


    // V·∫Ω danh s√°ch KND ra m√†n h√¨nh
    function renderKND(list) {
      // (H√†m n√†y gi·ªØ nguy√™n)
      container.innerHTML = "";
      if (!list || list.length === 0) {
           container.innerHTML = `<p class="text-center text-muted">Kh√¥ng c√≥ ƒë·ªãa ƒëi·ªÉm n√†o ph√π h·ª£p.</p>`;
           return; 
      }
      list.forEach((knd, index) => {
        const hasMap = !!knd.map;
        const html = `
        <div class="content-box fade-in mb-4" id="item-knd-${knd.id}">
          <div id="media-${index}" class="media-box" data-showing="image">
            <img src="${knd.anh}" alt="${knd.ten}" class="rounded shadow-sm w-100" />
          </div>
          <div class="text-box mt-3">
            <h5 class="text-center fw-bold">${knd.ten}</h5>
            ${knd.diaChi ? `<p class="text-center text-muted mb-1"><i class="bi bi-geo-alt"></i> ${knd.diaChi}</p>` : ''}
            <p class="mo-ta mb-2">${knd.moTa}</p>
            <div class="d-flex justify-content-center gap-3 flex-wrap">
              ${hasMap ? `
                <button class="btn btn-outline-primary nuthanhdong" 
                        id="btnMap-${index}" 
                        onclick="toggleMap(${index}, '${knd.anh}', '${knd.map}')">
                  <i class="bi bi-geo-alt"></i> 
                </button>` : ""
              }
              <button class="btn btn-outline-success nuthanhdong" onclick="handleYeuThich(${knd.id})">
                <i class="bi bi-heart"></i>
              </button>
            </div>
          </div>
        </div>`;
        container.insertAdjacentHTML("beforeend", html);
      });
    }

    // X·ª≠ l√Ω khi nh·∫•n n√∫t T√¨m ki·∫øm (Enter)
    function searchKND(e) {
      // (H√†m n√†y gi·ªØ nguy√™n)
      e.preventDefault();
      const kw = searchInput.value.trim().toLowerCase();
      
      // L·ªçc b·∫±ng 'nhom' (vuichoi, nghiduong,...) ƒë√£ ƒë∆∞·ª£c PHP x·ª≠ l√Ω
      const filtered = kndList.filter((d) =>
        (currentGroup === "all" || d.nhom === currentGroup) && 
        (d.ten.toLowerCase().includes(kw) ||                   
         d.moTa.toLowerCase().includes(kw) ||
         (d.diaChi && d.diaChi.toLowerCase().includes(kw)))
      );
      
      renderKND(filtered);
      suggestionsBox.innerHTML = ''; 
      if (filtered.length > 0) {
        const firstResultId = `item-knd-${filtered[0].id}`;
        const firstResultElement = document.getElementById(firstResultId);
        if (firstResultElement) {
          setTimeout(() => {
            firstResultElement.scrollIntoView({ behavior: 'smooth', block: 'start' });
          }, 100); 
        }
      }
      return false;
    }

    // X·ª≠ l√Ω khi nh·∫•n n√∫t Ph√¢n lo·∫°i
    function toggleSection(loai, e) {
      // (H√†m n√†y gi·ªØ nguy√™n)
      document.querySelectorAll(".btn-food").forEach((b) => b.classList.remove("active"));
      e.target.classList.add("active");
      
      // Map 'loai' t·ª´ onclick (haiSan, duongPho...) sang 'nhom' (vuichoi, nghiduong...)
      if (loai === "haiSan") currentGroup = "vuichoi";
      else if (loai === "duongPho") currentGroup = "nghiduong";
      else if (loai === "Qua") currentGroup = "sinhthai";
      else currentGroup = "all"; 
      
      searchKND(new Event('submit'));
    }

    // X·ª≠ l√Ω b·∫≠t/t·∫Øt b·∫£n ƒë·ªì
    function toggleMap(index, imgPath, mapLink) {
      // (H√†m n√†y gi·ªØ nguy√™n)
      const mediaDiv = document.getElementById(`media-${index}`);
      const btn = document.getElementById(`btnMap-${index}`);
      if (!mediaDiv || !btn) return;
      const showing = mediaDiv.dataset.showing;
      if (showing === "map") {
        mediaDiv.innerHTML = `<img src="${imgPath}" alt="·∫£nh ƒë·ªãa danh" class="img-fluid rounded shadow-sm" />`;
        mediaDiv.dataset.showing = "image";
        btn.firstElementChild.className = "bi bi-geo-alt"; 
      } else {
        mediaDiv.innerHTML = `<iframe src="${mapLink}" width="100%" height="350" style="border:0;" allowfullscreen loading="lazy"></iframe>`;
        mediaDiv.dataset.showing = "map";
        btn.firstElementChild.className = "bi bi-image"; 
      }
    }

    // X·ª≠ l√Ω n√∫t Y√™u th√≠ch
    async function handleYeuThich(id) {
      // (H√†m n√†y gi·ªØ nguy√™n)
      if (!isLoggedIn) {
        const goLogin = confirm("Vui l√≤ng ƒëƒÉng nh·∫≠p ƒë·ªÉ th√™m v√†o y√™u th√≠ch!");
        if (goLogin) window.location.href = "dangNhap.html";
        return;
      }
      try {
        const res = await fetch("YT.php", {
          method: "POST",
          headers: { "Content-Type": "application/json" },
          body: JSON.stringify({ action: "add", loai: "KND", id: id }),
        });
        const data = await res.json();
        if (data.needLogin) {
          alert("Phi√™n ƒëƒÉng nh·∫≠p ƒë√£ h·∫øt h·∫°n. Vui l√≤ng ƒëƒÉng nh·∫≠p!");
          window.location.href = "dangNhap.html";
        } else if (data.success) {
          alert(data.message || "ƒê√£ th√™m v√†o m·ª•c y√™u th√≠ch!");
        } else {
          alert(data.message || "M·ª•c n√†y ƒë√£ c√≥ trong m·ª•c y√™u th√≠ch!");
        }
      } catch (err) {
        console.error(err);
        alert("ƒê√£ c√≥ l·ªói x·∫£y ra. Vui l√≤ng th·ª≠ l·∫°i sau!");
      }
    }

    // --- C√ÅC H√ÄM G·ª¢I √ù (Gi·ªØ nguy√™n) ---
    function handleSearchInput(e) {
      // (H√†m n√†y gi·ªØ nguy√™n)
      const term = e.target.value.trim().toLowerCase();
      if (term.length === 0) {
        suggestionsBox.innerHTML = '';
        return;
      }
      const suggestions = kndList
        .filter(d => d.ten.toLowerCase().includes(term))
        .map(d => d.ten); 
      const limitedSuggestions = [...new Set(suggestions)].slice(0, 5);
      renderSuggestions(limitedSuggestions);
    }
    function renderSuggestions(suggestions) {
      // (H√†m n√†y gi·ªØ nguy√™n)
      suggestionsBox.innerHTML = '';
      if (suggestions.length === 0) return;
      suggestions.forEach(suggestion => {
        const item = document.createElement('a');
        item.className = 'list-group-item list-group-item-action';
        item.textContent = suggestion;
        item.onclick = () => selectSuggestion(suggestion); 
        suggestionsBox.appendChild(item);
      });
    }
    function selectSuggestion(suggestion) {
      // (H√†m n√†y gi·ªØ nguy√™n)
      searchInput.value = suggestion; 
      suggestionsBox.innerHTML = '';  
      document.querySelectorAll(".btn-food").forEach((b) => b.classList.remove("active"));
      document.querySelector(".btn-food[onclick*='dacSan']").classList.add("active");
      currentGroup = 'all';
      searchKND(new Event('submit')); 
    }

    // ========= INIT (KH·ªûI CH·∫†Y) =========
    document.addEventListener("DOMContentLoaded", () => {
      // (H√†m n√†y gi·ªØ nguy√™n)
      loadKND();
      window.addEventListener('hashchange', handleHashScroll);
      fetch('getUser.php')
        .then(res => res.json())
        .then(data => {
          if (data.loggedIn) {
            isLoggedIn = true;
            loginSection.innerHTML = `
              <a class="login-text" href ="suaHS.html"><i class="bi bi-person-circle me-2 fs-5" ></i>${data.TenTaiKhoan}</a>
              <a href="dangXuat.php" class="login-text ms-3">
                <i class="bi bi-box-arrow-in-right me-2 fs-5"></i>ƒêƒÇNG XU·∫§T
              </a>
            `;
            navbarMenu.querySelector('ul.navbar-nav').innerHTML = `
              <li class="nav-item"><a class="nav-link" href="TrangChu.html">TRANG CH·ª¶</a></li>
              <li class="nav-item"><a class="nav-link" href="diaDanh.html">ƒê·ªäA DANH N·ªîI B·∫¨T</a></li>
              <li class="nav-item"><a class="nav-link" href="Food.html">·∫®M TH·ª∞C</a></li>
              <li class="nav-item"><a class="nav-link" href="nghiDuong.html">NGH·ªà D∆Ø·ª†NG</a></li>
              <li class="nav-item"><a class="nav-link" href="tour.html">TOUR</a></li>
              <li class="nav-item"><a class="nav-link" href="YT.html">M·ª§C Y√äU TH√çCH</a></li>
              <li class="nav-item"><a class="nav-link" href="Lichsu.html">L·ªäCH S·ª¨ ƒê·∫∂T TOUR</a></li>
            `;
          }
        });
      searchInput.addEventListener('input', handleSearchInput);
      document.addEventListener('click', function (e) {
        if (e.target !== searchInput && !suggestionsBox.contains(e.target)) {
          suggestionsBox.innerHTML = '';
        }
      });
    });
  </script>
</body>
</html>