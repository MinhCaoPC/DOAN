<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Tour</title>
  <!-- Bootstrap -->
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">
  <link href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.3/font/bootstrap-icons.css" rel="stylesheet">

  <!-- CSS riÃªng -->
  <link rel="stylesheet" href="tour.css">
</head>

<body>
  <!-- Navbar -->
  <nav class="navbar navbar-expand-lg navbar-dark navbar-custom fixed-top">
    <div class="container">
      <!-- Logo -->
      <a class="navbar-logo-fixed" href="TrangChu.html">
        <img src="images/logo.png" alt="Logo" class="logo-fixed" />
      </a>

      <!-- Toggler -->
      <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarMenu">
        <span class="navbar-toggler-icon"></span>
      </button>

      <!-- Menu -->
      <div class="collapse navbar-collapse justify-content-center" id="navbarMenu">
        <ul class="navbar-nav">
          <li class="nav-item"><a class="nav-link" href="TrangChu.html">TRANG CHá»¦</a></li>
          <li class="nav-item">
            <a class="nav-link" href="diaDanh.html">Äá»ŠA DANH Ná»”I Báº¬T</a>
          </li>
          <li class="nav-item"><a class="nav-link" href="Food.html">áº¨M THá»°C</a></li>
          <li class="nav-item">
            <a class="nav-link" href="nghiDuong.html">NGHá»ˆ DÆ¯á» NG</a>
          </li>
          <li class="nav-item">
            <a class="nav-link active" href="tour.html">TOUR</a>
          </li>
        </ul>

        <div class="login-section" id="login-section">
          <a href="dangNhap.html" class="login-text">
            <i class="bi bi-person-circle me-2 fs-5"></i>ÄÄ‚NG NHáº¬P
          </a>
        </div>
      </div>
    </div>
  </nav>

  <!-- Banner -->
  <section class="banner">
    <div class="banner-content">
      <h1>DA NANG</h1>

      <!-- Bá»™ sÆ°u táº­p áº£nh -->
      <div class="gallery">
      </div>
      <!-- NÃºt khÃ¡m phÃ¡ ngay -->
      <a href="#tour" class="explore-btn">KhÃ¡m phÃ¡ ngay</a>
    </div>
  </section>
  <div class="container py-5">
    <p class="danang-desc">
      ÄÃ  Náºµng â€“ thÃ nh phá»‘ cá»§a nhá»¯ng cÃ¢y cáº§u, biá»ƒn xanh, nÃºi non hÃ¹ng vÄ© vÃ  con ngÆ°á»i thÃ¢n thiá»‡n.<br>
      Äáº¿n Ä‘Ã¢y, báº¡n sáº½ vá»«a Ä‘Æ°á»£c táº­n hÆ°á»Ÿng khÃ´ng khÃ­ biá»ƒn trong lÃ nh, vá»«a khÃ¡m phÃ¡ vÄƒn hÃ³a â€“ áº©m thá»±c Ä‘áº·c trÆ°ng miá»n
      Trung.<br>
      Tá»« nghá»‰ dÆ°á»¡ng sang trá»ng Ä‘áº¿n nhá»¯ng tráº£i nghiá»‡m Ä‘á»‹a phÆ°Æ¡ng Ä‘áº­m cháº¥t Viá»‡t, ÄÃ  Náºµng luÃ´n cÃ³ thá»© khiáº¿n báº¡n say mÃª.
    </p>

    <h2 id="tour" class="text-center mb-4 fw-bold">ğŸŒ´ TOUR DU Lá»ŠCH ÄÃ€ Náº´NG</h2>


    <!-- Äiá»u hÆ°á»›ng tour -->
    <ul class="nav nav-pills justify-content-center mb-4" id="tourTabs" role="tablist">
    </ul>

    <!-- Chi tiáº¿t tour-->
    <div class="tab-content" id="tourContent">


    </div>
    <div class="tab-content" id="tourContent">
    </div>

    <h2 class="text-center mb-4 fw-bold">âœ¨ Tour ná»•i báº­t khÃ¡c</h2>

    <div id="tourCarousel" class="carousel slide" data-bs-ride="carousel">
      <div class="carousel-inner">
      </div>
      <button class="carousel-control-prev" type="button" data-bs-target="#tourCarousel" data-bs-slide="prev">
        <span class="carousel-control-prev-icon" aria-hidden="true"></span>
        <span class="visually-hidden">TrÆ°á»›c</span>
      </button>
      <button class="carousel-control-next" type="button" data-bs-target="#tourCarousel" data-bs-slide="next">
        <span class="carousel-control-next-icon" aria-hidden="true"></span>
        <span class="visually-hidden">Sau</span>
      </button>
    </div>
    <div class="modal fade" id="bookingModal" tabindex="-1" aria-labelledby="bookingModalLabel" aria-hidden="true">
      <div class="modal-dialog modal-dialog-centered">
        <div class="modal-content p-4">
          <h5 class="modal-title mb-3 text-center" id="bookingModalLabel">Äáº·t Tour Ngay</h5>

          <form id="bookingForm">
            <div class="mb-3">
              <label class="form-label">Chá»n tour</label>
              <input type="text" id="selectedTour" class="form-control" readonly>
              <input type="hidden" id="selectedTourId" name="MaTour">
            </div>
            <div class="mb-3">
              <label class="form-label">Há» vÃ  tÃªn</label>
              <input type="text" class="form-control" id="inputHoTen" placeholder="Nháº­p há» tÃªn cá»§a báº¡n" required>
            </div>
            <div class="mb-3">
              <label class="form-label">Sá»‘ Ä‘iá»‡n thoáº¡i</label>
              <input type="tel" class="form-control" id="inputSDT" placeholder="Nháº­p sá»‘ Ä‘iá»‡n thoáº¡i" required>
            </div>
            <div class="mb-3">
              <label class="form-label">Email</label>
              <input type="email" class="form-control" id="inputEmail" placeholder="Nháº­p email" required>
            </div>
            <div class="mb-3">
              <label class="form-label">Äá»‹a chá»‰</label>
              <input type="text" class="form-control" id="inputDiaChi" placeholder="Äá»‹a chá»‰ hiÃªn táº¡i">
            </div>

            <div class="mb-3">
              <label class="form-label">Sá»‘ lÆ°á»£ng khÃ¡ch</label>
              <input type="number" class="form-control" id="inputSoLuong" value="1" min="1" required>
            </div>
            <button type="submit" class="btn btn-book w-100 mt-2">XÃ¡c nháº­n Ä‘áº·t tour</button>
          </form>
        </div>
      </div>
    </div>
    </div>

    <section class="why-choose py-5">
      <div class="container text-center">
        <h3 class="fw-bold mb-4">ğŸŒŸ VÃ¬ sao nÃªn chá»n chÃºng tÃ´i?</h3>
        <div class="row g-4">
          <div class="col-md-4">
            <i class="bi bi-star-fill fs-1 text-warning"></i>
            <h5 class="fw-bold mt-2">Uy tÃ­n hÃ ng Ä‘áº§u</h5>
            <p>Äá»‘i tÃ¡c cá»§a cÃ¡c khu du lá»‹ch vÃ  khÃ¡ch sáº¡n lá»›n táº¡i ÄÃ  Náºµng.</p>
          </div>
          <div class="col-md-4">
            <i class="bi bi-wallet2 fs-1 text-success"></i>
            <h5 class="fw-bold mt-2">GiÃ¡ tá»‘t â€“ Trá»n gÃ³i</h5>
            <p>KhÃ´ng phá»¥ phÃ­ áº©n, bao gá»“m xe Ä‘Æ°a Ä‘Ã³n vÃ  hÆ°á»›ng dáº«n viÃªn.</p>
          </div>
          <div class="col-md-4">
            <i class="bi bi-heart-fill fs-1 text-danger"></i>
            <h5 class="fw-bold mt-2">ChÄƒm sÃ³c táº­n tÃ¢m</h5>
            <p>Há»— trá»£ 24/7 trÆ°á»›c, trong vÃ  sau khi Ä‘i tour.</p>
          </div>
        </div>
      </div>
    </section>


    <footer class="footer text-light">
      <div class="container py-5">
        <div class="row gy-4">

          <div class="col-md-4">
            <h3 class="footer-logo">ÄÃ  Náºµng Travel</h3>
            <p>KhÃ¡m phÃ¡ váº» Ä‘áº¹p ÄÃ  Náºµng â€“ thÃ nh phá»‘ Ä‘Ã¡ng sá»‘ng nháº¥t Viá»‡t Nam.
              ChÃºng tÃ´i mang Ä‘áº¿n nhá»¯ng tráº£i nghiá»‡m du lá»‹ch Ä‘á»™c Ä‘Ã¡o vÃ  tiá»‡n lá»£i.</p>
          </div>

          <div class="col-md-4">
            <h5>LiÃªn káº¿t nhanh</h5>
            <ul class="footer-links">
              <li><a href="TrangChu.html">Trang Chá»§</a></li>
              <li><a href="diaDanh.html">Äá»‹a Danh</a></li>
              <li><a href="nghiDuong.html">Nghá»‰ DÆ°á»¡ng</a></li>
              <li><a href="Food.html">áº¨m thá»±c</a></li>
              <li><a href="tour.html">Tour</a></li>
            </ul>
          </div>

          <div class="col-md-4">
            <h5>LiÃªn há»‡</h5>
            <p><i class="fas fa-map-marker-alt"></i> 123 ÄÆ°á»ng Báº¡ch Äáº±ng, ÄÃ  Náºµng</p>
            <p><i class="fas fa-phone"></i> 0901 234 567</p>
            <p><i class="fas fa-envelope"></i> info@danangtravel.vn</p>

            <div class="social-icons mt-3">
              <a href="#"><i class="fab fa-facebook-f"></i></a>
              <a href="#"><i class="fab fa-instagram"></i></a>
              <a href="#"><i class="fab fa-tiktok"></i></a>
            </div>
          </div>
        </div>
      </div>

      <div class="footer-bottom text-center py-3">
        <p>Â© 2025 ÄÃ  Náºµng Travel. Thiáº¿t káº¿ bá»Ÿi <strong>CTV Team</strong>.</p>
      </div>
    </footer>

    <a href="goiyTour.html" id="btnGoiYTour" class="floating-btn" title="Gá»£i Ã½ Tour cÃ¡ nhÃ¢n" style="display: none;">
      <i class="bi bi-robot"></i>
      <span class="tooltip-text">Gá»£i Ã½ Tour</span>
    </a>
    <a href="lienhe.html" class="floating-btn" title="Báº¡n cáº§n tÆ° váº¥n?" style="bottom: 90px;">
      <i class="bi bi-phone"></i>
      <span class="tooltip-text">Báº¡n cáº§n tÆ° váº¥n?</span>
    </a>


    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"></script>


    <script>
      // Biáº¿n toÃ n cá»¥c Ä‘á»ƒ dÃ¹ng chung
      let tourList = [];
      let isLoggedIn = false;
      let currentUser = null;

      // --- HÃ€M 0: Xá»­ lÃ½ Hash Link (FIX Lá»–I CÆ  Báº¢N) ---
      function handleHashScroll() {
        const hash = window.location.hash; // Láº¥y hash, vÃ­ dá»¥: #item-tour-123

        if (hash && hash.startsWith('#item-tour-')) {
          // 1. TÃ¬m nÃºt Ä‘iá»u hÆ°á»›ng (nav-link) tÆ°Æ¡ng á»©ng vá»›i hash
          // NÃºt nÃ y cÃ³ data-bs-target = hash
          const tabTrigger = document.querySelector(`[data-bs-target="${hash}"]`);
          const targetElement = document.querySelector(hash);

          if (tabTrigger) {
            // 2. KÃ­ch hoáº¡t tab báº±ng Bootstrap API
            const tab = new bootstrap.Tab(tabTrigger);
            tab.show();

            // 3. Cuá»™n Ä‘áº¿n vá»‹ trÃ­ cá»§a tab (thÃªm delay Ä‘á»ƒ Bootstrap ká»‹p kÃ­ch hoáº¡t)
            setTimeout(() => {
              if (targetElement) {
                targetElement.scrollIntoView({ behavior: 'smooth', block: 'start' });
                // ThÃªm hiá»‡u á»©ng ná»•i báº­t táº¡m thá»i
                targetElement.style.boxShadow = '0 0 15px 5px rgba(255, 193, 7, 0.7)';
                setTimeout(() => {
                  targetElement.style.boxShadow = 'none';
                }, 2000);
              }
            }, 200);

          } else if (targetElement) {
            // Náº¿u hash khÃ´ng pháº£i lÃ  tab (vÃ­ dá»¥: #tour), váº«n cuá»™n
            targetElement.scrollIntoView({ behavior: 'smooth', block: 'start' });
          }
        } else if (hash) {
          // Cho cÃ¡c hash khÃ¡c (vÃ­ dá»¥: #tour)
          const targetElement = document.querySelector(hash);
          if (targetElement) {
            targetElement.scrollIntoView({ behavior: 'smooth', block: 'start' });
          }
        }
      }

      // --- HÃ€M 1: Táº£i tour chÃ­nh (gallery, tabs) ---
      async function loadMainTours() {
        try {
          // Äáº£m báº£o fetch xong má»›i thá»±c hiá»‡n cÃ¡c bÆ°á»›c tiáº¿p theo
          const res = await fetch('tour.php');
          const data = await res.json();

          if (data.status === 'success' && Array.isArray(data.tourList)) {
            tourList = data.tourList;
          } else {
            tourList = [];
          }
          document.dispatchEvent(new CustomEvent('tours:loaded', { detail: { tourList } }));
        } catch (err) {
          console.error('Lá»—i táº£i tour chÃ­nh:', err);
          tourList = [];
        }
      }

      // --- HÃ€M 2: Táº£i tour ná»•i báº­t (carousel) ---
      async function loadFeaturedTours() {
        try {
          const res = await fetch('tourNoiBat.php');
          const data = await res.json();
          if (data.status === 'success' && Array.isArray(data.featuredTours)) {
            const carouselInner = document.querySelector("#tourCarousel .carousel-inner");
            data.featuredTours.forEach((tour, index) => {
              const activeClass = (index === 0) ? 'active' : '';
              const item = document.createElement('div');
              item.className = `carousel-item ${activeClass}`;

              item.innerHTML = `
            <div class="card">
              <img src="${tour.anh || 'images/placeholder.jpg'}" class="card-img-top" alt="${tour.ten}">
              <div class="card-body text-center">
                <h5 class="card-title">${tour.ten}</h5>
                
                <p class="card-text">
                  â° <b>${tour.thoiGian || 'ChÆ°a cáº­p nháº­t'}</b><br>
                  ğŸ’° ${tour.gia || 'LiÃªn há»‡'}
                </p>
                
                <button class="fav-btn" onclick="handleYeuThich(${tour.id})">
                  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.0/css/all.min.css">
                  <i class="fas fa-heart"></i> ThÃªm má»¥c yÃªu thÃ­ch
                </button>
                <a href="#" class="btn btn-book mt-2" 
                   data-bs-toggle="modal" 
                   data-bs-target="#bookingModal"
                   data-tour="${tour.ten}"
                   data-tour-id="${tour.id}">
                  Äáº·t ngay
                </a>
              </div>
            </div>`;
              carouselInner.appendChild(item);
            });

            // Khá»Ÿi Ä‘á»™ng carousel
            const carouselElement = document.getElementById('tourCarousel');
            const carousel = new bootstrap.Carousel(carouselElement, {
              interval: 3000,
              ride: 'carousel'
            });
            carousel.cycle();

          }
        } catch (err) {
          console.error('Lá»—i táº£i tour ná»•i báº­t:', err);
        }
      }

      // --- HÃ€M 3: Xá»­ lÃ½ YÃªu thÃ­ch ---
      async function handleYeuThich(id) {
        if (!isLoggedIn) {
          const goLogin = confirm("Vui lÃ²ng Ä‘Äƒng nháº­p Ä‘á»ƒ thÃªm tour vÃ o yÃªu thÃ­ch!");
          if (goLogin) window.location.href = "dangNhap.html";
          return;
        }
        try {
          const res = await fetch("YT.php", {
            method: "POST",
            headers: { "Content-Type": "application/json" },
            body: JSON.stringify({ action: "add", loai: "TOUR", id: id }),
          });
          const data = await res.json();
          if (data.needLogin) {
            alert("PhiÃªn Ä‘Äƒng nháº­p Ä‘Ã£ háº¿t háº¡n. Vui lÃ²ng Ä‘Äƒng nháº­p!");
            window.location.href = "dangNhap.html";
            return;
          }
          if (data.success) {
            alert(data.message || "ÄÃ£ thÃªm vÃ o má»¥c yÃªu thÃ­ch!");
          } else {
            alert(data.message || "Má»¥c nÃ y Ä‘Ã£ cÃ³ trong má»¥c yÃªu thÃ­ch!");
          }
        } catch (err) {
          console.error(err);
          alert("ÄÃ£ cÃ³ lá»—i xáº£y ra. Vui lÃ²ng thá»­ láº¡i sau!");
        }
      }

      // --- Sá»° KIá»†N 1: Khi DOM táº£i xong ---
      document.addEventListener("DOMContentLoaded", () => {

        // Táº£i tour chÃ­nh vÃ  tour ná»•i báº­t
        loadMainTours();
        loadFeaturedTours();

        // Xá»­ lÃ½ Ä‘Äƒng nháº­p
        const loginSection = document.getElementById('login-section');
        const navbarMenu = document.getElementById('navbarMenu');

        fetch('getUser.php')
          .then(res => res.json())
          .then(data => {
            if (data.loggedIn) {
              isLoggedIn = true;
              currentUser = data; // LÆ°u thÃ´ng tin user
              loginSection.innerHTML = `
            <a class="login-text" href ="suaHS.html"><i class="bi bi-person-circle me-2 fs-5" ></i>${data.TenTaiKhoan}</a>
            <a href="dangXuat.php" class="login-text ms-3">
              <i class="bi bi-box-arrow-in-right me-2 fs-5"></i>ÄÄ‚NG XUáº¤T
            </a>`;
              navbarMenu.querySelector('ul.navbar-nav').innerHTML = `
            <li class="nav-item"><a class="nav-link" href="TrangChu.html">TRANG CHá»¦</a></li>
            <li class="nav-item"><a class="nav-link" href="diaDanh.html">Äá»ŠA DANH Ná»”I Báº¬T</a></li>
            <li class="nav-item"><a class="nav-link" href="Food.html">áº¨M THá»°C</a></li>
            <li class="nav-item"><a class="nav-link" href="nghiDuong.html">NGHá»ˆ DÆ¯á» NG</a></li>
            <li class="nav-item"><a class="nav-link active" href="tour.html">TOUR</a></li>
            <li class="nav-item"><a class="nav-link" href="YT.html">Má»¤C YÃŠU THÃCH</a></li>
            <li class="nav-item"><a class="nav-link" href="Lichsu.html">Lá»ŠCH Sá»¬ Äáº¶T TOUR</a></li>`;
              const btnGoiY = document.getElementById('btnGoiYTour');
              if (btnGoiY) {
                btnGoiY.style.display = 'flex';
              }
            }
          });

        // Xá»­ lÃ½ click cho gallery (Tá»‘i Æ°u hÃ³a Ä‘á»ƒ dÃ¹ng chung hÃ m handleHashScroll)
        const galleryContainer = document.querySelector(".gallery");
        if (galleryContainer) {
          galleryContainer.addEventListener("click", function (event) {
            if (event.target.tagName === 'IMG') {
              const img = event.target;
              const tourHash = img.getAttribute("data-tour"); // e.g., #item-tour-123
              if (tourHash) {
                // Thay Ä‘á»•i hash, sáº½ kÃ­ch hoáº¡t window.onhashchange
                window.location.hash = tourHash;
                event.preventDefault(); // NgÄƒn hÃ nh vi máº·c Ä‘á»‹nh náº¿u lÃ  link
              }
            }
          });
        }

        // Gáº¯n sá»± kiá»‡n Ä‘á»ƒ xá»­ lÃ½ hash khi táº£i trang vÃ  khi hash thay Ä‘á»•i
        window.addEventListener('hashchange', handleHashScroll);
      });

      // --- Sá»° KIá»†N 2: Khi tour chÃ­nh táº£i xong (Váº½ gallery, tabs) ---
      document.addEventListener('tours:loaded', function (e) {
        const list = e.detail?.tourList || [];
        const tourContent = document.getElementById('tourContent');
        const tourTabs = document.getElementById('tourTabs');
        const galleryContainer = document.querySelector(".gallery");

        tourContent.innerHTML = '';
        tourTabs.innerHTML = '';
        galleryContainer.innerHTML = '';

        if (!list.length) {
          tourContent.innerHTML = '<div class="alert alert-warning">ChÆ°a cÃ³ tour nÃ o.</div>';
          return;
        }

        list.forEach((tour, index) => {
          // âœ… Sá»¬A Lá»–I: Sá»­ dá»¥ng MaTour Ä‘á»ƒ táº¡o ID linkable
          const tourItemId = `item-tour-${tour.id}`;

          // 1. Táº O áº¢NH CHO GALLERY
          const img = document.createElement('img');
          img.src = tour.anhSub || 'images/placeholder.jpg';
          img.alt = tour.ten || 'áº¢nh tour';
          // âœ… GÃ¡n ID má»›i cho data-tour
          img.setAttribute('data-tour', `#${tourItemId}`);
          galleryContainer.appendChild(img);

          // 2. Táº O NÃšT TAB
          const li = document.createElement('li');
          li.className = 'nav-item';
          // âœ… GÃ¡n ID má»›i cho data-bs-target
          li.innerHTML = `<button class="nav-link ${index === 0 ? 'active' : ''}" data-bs-toggle="pill" data-bs-target="#${tourItemId}" type="button">Tour ${index + 1}</button>`;
          tourTabs.appendChild(li);

          // 3. Táº O Ná»˜I DUNG TAB
          const tabPane = document.createElement('div');
          // Tab Ä‘áº§u tiÃªn active náº¿u khÃ´ng cÃ³ hash
          tabPane.className = `tab-pane fade ${index === 0 ? 'show active' : ''}`;
          // âœ… GÃ¡n ID má»›i cho Tab Pane
          tabPane.id = tourItemId;
          tabPane.setAttribute('role', 'tabpanel');

          const lichTrinh = Array.isArray(tour.lichTrinh) ? tour.lichTrinh : [];
          const lichTrinhHtml = lichTrinh.map(item => `<li>${item}</li>`).join('');
          tabPane.innerHTML = `
        <div class="row g-4 align-items-center">
          <div class="col-md-6">
            <img src="${tour.anh || 'images/placeholder.jpg'}" alt="${tour.ten || ''}" class="tour-img">
          </div>
          <div class="col-md-6">
            <h4 class="fw-bold">TOUR ${index + 1}: ${tour.ten || ''}</h4>
            <p>â° <b>${tour.thoiGian || ''}</b><br>
            ğŸ’° ${tour.gia || ''}<br>
            ğŸ‘¥ ${tour.doiTuong || ''}<br>
            ğŸ¨ ${tour.khachSan || ''}</p>
            <h6 class="fw-bold">ğŸ—“ Lá»‹ch trÃ¬nh chi tiáº¿t:</h6>
            <ul>${lichTrinhHtml}</ul>
            <button class="fav-btn" onclick="handleYeuThich(${tour.id})">
              <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.0/css/all.min.css">
              <i class="fas fa-heart"></i> ThÃªm má»¥c yÃªu thÃ­ch
            </button>
            <a href="#" class="btn btn-book mt-2" data-bs-toggle="modal"
               data-bs-target="#bookingModal" 
               data-tour="${tour.ten || ''}"
               data-tour-id="${tour.id}"> Äáº·t ngay
            </a>
          </div>
        </div>`;
          tourContent.appendChild(tabPane);
        });

        // Sau khi táº£i vÃ  váº½ xong tour, gá»i hÃ m xá»­ lÃ½ hash Ä‘á»ƒ kÃ­ch hoáº¡t tab (náº¿u cÃ³ hash)
        handleHashScroll();
      });

      // --- Sá»° KIá»†N 3: Xá»­ lÃ½ Modal (Tá»± Ä‘á»™ng Ä‘iá»n) ---
      const bookingModal = document.getElementById('bookingModal');
      bookingModal.addEventListener('show.bs.modal', function (event) {
        const button = event.relatedTarget;

        // Láº¥y TÃªn Tour
        const tourName = button.getAttribute('data-tour');
        bookingModal.querySelector('#selectedTour').value = tourName;

        // Láº¤Y ID TOUR
        const tourId = button.getAttribute('data-tour-id');
        bookingModal.querySelector('#selectedTourId').value = tourId;

        // Tá»° Äá»˜NG ÄIá»€N THÃ”NG TIN
        const inputHoTen = bookingModal.querySelector('#inputHoTen');
        const inputSDT = bookingModal.querySelector('#inputSDT');
        const inputEmail = bookingModal.querySelector('#inputEmail');
        const inputDiaChi = bookingModal.querySelector('#inputDiaChi');
        const inputSoLuong = bookingModal.querySelector('#inputSoLuong');

        if (currentUser) {
          // YÃªu cáº§u: Æ¯u tiÃªn HoVaTen, náº¿u trá»‘ng thÃ¬ dÃ¹ng TenTaiKhoan
          inputHoTen.value = currentUser.HoVaTen || currentUser.TenTaiKhoan || '';

          // YÃªu cáº§u: Láº¥y SDT tá»« KHACHHANG
          inputSDT.value = currentUser.SDT || '';

          // YÃªu cáº§u: Láº¥y Email tá»« TAIKHOAN
          inputEmail.value = currentUser.Email || '';

          // YÃªu cáº§u: Láº¥y DiaChi tá»« KHACHHANG
          inputDiaChi.value = currentUser.DiaChi || '';

        } else {
          // Náº¿u chÆ°a Ä‘Äƒng nháº­p, xÃ³a trá»‘ng
          inputHoTen.value = '';
          inputSDT.value = '';
          inputEmail.value = '';
          inputDiaChi.value = '';
        }
        inputSoLuong.value = 1; // Reset sá»‘ lÆ°á»£ng
      });

      // --- Sá»° KIá»†N 4: Xá»­ lÃ½ Submit Form Äáº·t Tour ---
      document.getElementById('bookingForm').addEventListener('submit', async function (event) {
        event.preventDefault(); // NgÄƒn táº£i láº¡i trang

        if (!isLoggedIn) {
          alert("Vui lÃ²ng Ä‘Äƒng nháº­p Ä‘á»ƒ Ä‘áº·t tour!");
          window.location.href = "dangNhap.html";
          return;
        }

        const formData = {
          MaTour: document.getElementById('selectedTourId').value,
          HoVaTen: document.getElementById('inputHoTen').value,
          SDT: document.getElementById('inputSDT').value,
          Email: document.getElementById('inputEmail').value,
          DiaChi: document.getElementById('inputDiaChi').value,
          SoLuong: document.getElementById('inputSoLuong').value
        };

        try {
          // Gá»­i dá»¯ liá»‡u Ä‘áº¿n file datTour.php
          const res = await fetch('datTour.php', {
            method: 'POST',
            headers: { 'Content-Type': 'application/json' },
            body: JSON.stringify(formData)
          });
          const data = await res.json();

          if (data.success) {
            alert(data.message || 'Äáº·t tour thÃ nh cÃ´ng! ChÃºng tÃ´i sáº½ liÃªn há»‡ vá»›i báº¡n sá»›m.');
            const modalInstance = bootstrap.Modal.getInstance(bookingModal);
            modalInstance.hide();
            window.location.href = 'Lichsu.html';
          } else {
            if (data.needLogin) {
              alert("PhiÃªn Ä‘Äƒng nháº­p Ä‘Ã£ háº¿t háº¡n. Vui lÃ²ng Ä‘Äƒng nháº­p láº¡i!");
              window.location.href = "dangNhap.html";
            } else {
              alert('Lá»—i: ' + (data.message || 'KhÃ´ng thá»ƒ Ä‘áº·t tour.'));
            }
          }
        } catch (err) {
          console.error('Lá»—i khi submit form:', err);
          alert('ÄÃ£ xáº£y ra lá»—i káº¿t ná»‘i. Vui lÃ²ng thá»­ láº¡i.');
        }
      });

      // âœ… Bá» hÃ m handleHashScroll cÅ© á»Ÿ cuá»‘i vÃ¬ Ä‘Ã£ há»£p nháº¥t logic
    </script>
    <script>

      window.addEventListener('pageshow', function (event) {
        if (event.persisted) {
          document.querySelectorAll('.nav-link').forEach(function (link) {
            link.blur();
          });
          document.body.style.display = 'none';
          document.body.offsetHeight;
          document.body.style.display = '';
        }
      });
    </script>

</body>

</html>